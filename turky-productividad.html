<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turky - Control de Productividad</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--primary:#1a5f2a;--primary-light:#2d8a42;--accent:#f59e0b;--danger:#dc2626;--success:#16a34a;--warning:#ea580c;--bg-dark:#0c1810;--bg-card:#132419;--bg-input:#1a3324;--text-primary:#e8f5ec;--text-secondary:#9cb8a6;--text-muted:#5a7d66;--border:#2d5a3d;--crudos:#3b82f6;--apanados:#f59e0b;--derivados:#8b5cf6}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg-dark);color:var(--text-primary);min-height:100vh;background-image:radial-gradient(ellipse at 0% 0%,rgba(26,95,42,0.15) 0%,transparent 50%)}
        .header{background:linear-gradient(135deg,var(--bg-card) 0%,#0f3d1a 100%);border-bottom:1px solid var(--border);padding:1rem 1.5rem;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100}
        .logo{display:flex;align-items:center;gap:0.75rem}
        .logo-icon{width:42px;height:42px;background:linear-gradient(135deg,var(--primary) 0%,var(--primary-light) 100%);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.2rem}
        .logo-text{font-size:1.4rem;font-weight:700}.logo-text span{color:var(--accent)}
        .header-info{display:flex;align-items:center;gap:1rem}
        .header-date{font-family:'JetBrains Mono',monospace;font-size:0.85rem;color:var(--text-secondary);background:var(--bg-input);padding:0.5rem 1rem;border-radius:8px;border:1px solid var(--border)}
        .user-badge{display:flex;align-items:center;gap:0.75rem;background:var(--bg-input);padding:0.5rem 1rem;border-radius:8px;border:1px solid var(--border);cursor:pointer}
        .user-avatar{width:32px;height:32px;background:var(--primary);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:0.8rem}
        .user-name{font-size:0.85rem;font-weight:600}.user-role{font-size:0.7rem;color:var(--text-secondary)}
        .nav-container{background:var(--bg-card);border-bottom:1px solid var(--border);padding:0 1.5rem;overflow-x:auto}
        .nav-tabs{display:flex;gap:0.25rem}
        .nav-tab{padding:1rem 1.25rem;font-size:0.85rem;font-weight:500;color:var(--text-secondary);background:transparent;border:none;cursor:pointer;position:relative;white-space:nowrap;transition:all 0.2s}
        .nav-tab:hover{color:var(--text-primary);background:rgba(26,95,42,0.2)}
        .nav-tab.active{color:var(--accent)}.nav-tab.active::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:var(--accent);border-radius:3px 3px 0 0}
        .main-content{padding:1.5rem;max-width:1600px;margin:0 auto}
        .screen{display:none}.screen.active{display:block;animation:fadeIn 0.3s ease}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        .card{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:1.5rem;margin-bottom:1.5rem}
        .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.25rem;padding-bottom:1rem;border-bottom:1px solid var(--border)}
        .card-title{font-size:1.1rem;font-weight:600;display:flex;align-items:center;gap:0.5rem}
        .card-title-icon{width:28px;height:28px;background:var(--primary);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:0.9rem}
        .grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:1.5rem}
        .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:1.5rem}
        .grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem}
        @media(max-width:1200px){.grid-4,.grid-3{grid-template-columns:repeat(2,1fr)}}
        @media(max-width:768px){.grid-2,.grid-3,.grid-4{grid-template-columns:1fr}.header{flex-direction:column;gap:1rem}.header-info{width:100%;justify-content:space-between}}
        .stat-card{background:linear-gradient(135deg,var(--bg-card) 0%,var(--bg-input) 100%);border:1px solid var(--border);border-radius:12px;padding:1.25rem;position:relative;overflow:hidden}
        .stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--primary)}
        .stat-card.crudos::before{background:var(--crudos)}.stat-card.apanados::before{background:var(--apanados)}.stat-card.derivados::before{background:var(--derivados)}
        .stat-label{font-size:0.75rem;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.5rem}
        .stat-value{font-family:'JetBrains Mono',monospace;font-size:1.75rem;font-weight:700}.stat-unit{font-size:0.9rem;color:var(--text-secondary);font-weight:400}
        .stat-change{display:inline-flex;align-items:center;gap:0.25rem;font-size:0.75rem;margin-top:0.5rem;padding:0.25rem 0.5rem;border-radius:4px}
        .stat-change.positive{color:var(--success);background:rgba(22,163,74,0.15)}
        .form-group{margin-bottom:1.25rem}
        .form-label{display:block;font-size:0.8rem;font-weight:500;color:var(--text-secondary);margin-bottom:0.5rem}
        .form-input,.form-select{width:100%;padding:0.75rem 1rem;font-size:0.9rem;font-family:inherit;background:var(--bg-input);border:1px solid var(--border);border-radius:8px;color:var(--text-primary);transition:all 0.2s}
        .form-input:focus,.form-select:focus{outline:none;border-color:var(--primary-light);box-shadow:0 0 0 3px rgba(45,138,66,0.2)}
        .form-input::placeholder{color:var(--text-muted)}
        .form-select{cursor:pointer}.form-select option{background:var(--bg-dark);color:var(--text-primary)}
        .form-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem}
        .btn{display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;padding:0.75rem 1.5rem;font-size:0.9rem;font-weight:600;font-family:inherit;border:none;border-radius:8px;cursor:pointer;transition:all 0.2s}
        .btn-primary{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-light) 100%);color:white;box-shadow:0 4px 12px rgba(26,95,42,0.3)}
        .btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(26,95,42,0.4)}
        .btn-secondary{background:var(--bg-input);color:var(--text-primary);border:1px solid var(--border)}.btn-secondary:hover{background:var(--border)}
        .btn-danger{background:var(--danger);color:white}
        .btn-sm{padding:0.5rem 1rem;font-size:0.8rem}.btn-lg{padding:1rem 2rem;font-size:1rem}.btn-block{width:100%}
        .table-container{overflow-x:auto;border-radius:8px;border:1px solid var(--border)}
        .table{width:100%;border-collapse:collapse;font-size:0.85rem}
        .table th{background:var(--bg-input);padding:0.875rem 1rem;text-align:left;font-weight:600;color:var(--text-secondary);text-transform:uppercase;font-size:0.7rem;letter-spacing:0.05em;border-bottom:1px solid var(--border)}
        .table td{padding:0.875rem 1rem;border-bottom:1px solid var(--border);color:var(--text-primary)}
        .table tr:last-child td{border-bottom:none}.table tr:hover td{background:rgba(26,95,42,0.1)}
        .badge{display:inline-flex;align-items:center;padding:0.25rem 0.75rem;font-size:0.7rem;font-weight:600;border-radius:20px;text-transform:uppercase;letter-spacing:0.03em}
        .badge-crudos{background:rgba(59,130,246,0.2);color:var(--crudos)}
        .badge-apanados{background:rgba(245,158,11,0.2);color:var(--apanados)}
        .badge-derivados{background:rgba(139,92,246,0.2);color:var(--derivados)}
        .badge-success{background:rgba(22,163,74,0.2);color:var(--success)}
        .badge-warning{background:rgba(234,88,12,0.2);color:var(--warning)}
        .badge-danger{background:rgba(220,38,38,0.2);color:var(--danger)}
        .line-selector{display:flex;gap:0.75rem;margin-bottom:1.5rem;flex-wrap:wrap}
        .line-btn{flex:1;min-width:120px;padding:1rem;background:var(--bg-input);border:2px solid var(--border);border-radius:10px;cursor:pointer;transition:all 0.2s;text-align:center}
        .line-btn:hover{border-color:#3d7a52}.line-btn.active{border-color:var(--primary-light);background:rgba(26,95,42,0.2)}
        .line-btn.crudos.active{border-color:var(--crudos);background:rgba(59,130,246,0.15)}
        .line-btn.apanados.active{border-color:var(--apanados);background:rgba(245,158,11,0.15)}
        .line-btn.derivados.active{border-color:var(--derivados);background:rgba(139,92,246,0.15)}
        .line-btn-label{font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.05em}
        .line-btn-name{font-size:1rem;font-weight:600;margin-top:0.25rem}
        .line-btn.crudos .line-btn-name{color:var(--crudos)}.line-btn.apanados .line-btn-name{color:var(--apanados)}.line-btn.derivados .line-btn-name{color:var(--derivados)}
        .progress-bar{height:8px;background:var(--bg-input);border-radius:4px;overflow:hidden}
        .progress-fill{height:100%;background:linear-gradient(90deg,var(--primary) 0%,var(--primary-light) 100%);border-radius:4px;transition:width 0.3s ease}
        .operario-chips{display:flex;flex-wrap:wrap;gap:0.5rem;margin-top:0.5rem}
        .operario-chip{display:inline-flex;align-items:center;gap:0.5rem;padding:0.5rem 0.75rem;background:var(--bg-input);border:1px solid var(--border);border-radius:20px;font-size:0.8rem;cursor:pointer;transition:all 0.2s}
        .operario-chip:hover{border-color:var(--primary-light)}.operario-chip.selected{background:var(--primary);border-color:var(--primary);color:white}
        .operario-chip-avatar{width:24px;height:24px;background:var(--border);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.65rem;font-weight:600}
        .operario-chip.selected .operario-chip-avatar{background:rgba(255,255,255,0.2)}
        .quick-actions{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem}
        .quick-action{background:var(--bg-input);border:1px solid var(--border);border-radius:12px;padding:1.25rem;cursor:pointer;transition:all 0.2s;text-align:center}
        .quick-action:hover{border-color:var(--primary-light);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.2)}
        .quick-action-icon{width:48px;height:48px;margin:0 auto 0.75rem;background:var(--primary);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.5rem}
        .quick-action-title{font-weight:600;margin-bottom:0.25rem}.quick-action-desc{font-size:0.75rem;color:var(--text-secondary)}
        .modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;visibility:hidden;transition:all 0.3s}
        .modal-overlay.active{opacity:1;visibility:visible}
        .modal{background:var(--bg-card);border:1px solid var(--border);border-radius:16px;width:90%;max-width:600px;max-height:90vh;overflow-y:auto;transform:scale(0.9);transition:transform 0.3s}
        .modal-overlay.active .modal{transform:scale(1)}
        .modal-header{display:flex;justify-content:space-between;align-items:center;padding:1.25rem 1.5rem;border-bottom:1px solid var(--border)}
        .modal-title{font-size:1.1rem;font-weight:600}
        .modal-close{width:32px;height:32px;background:var(--bg-input);border:none;border-radius:8px;color:var(--text-secondary);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.25rem;transition:all 0.2s}
        .modal-close:hover{background:var(--danger);color:white}
        .modal-body{padding:1.5rem}.modal-footer{display:flex;justify-content:flex-end;gap:0.75rem;padding:1rem 1.5rem;border-top:1px solid var(--border)}
        .login-screen{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem}
        .login-card{background:var(--bg-card);border:1px solid var(--border);border-radius:20px;padding:2.5rem;width:100%;max-width:420px;text-align:center}
        .login-logo{width:80px;height:80px;margin:0 auto 1.5rem;background:linear-gradient(135deg,var(--primary) 0%,var(--primary-light) 100%);border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:2rem;box-shadow:0 8px 24px rgba(26,95,42,0.4)}
        .login-title{font-size:1.75rem;font-weight:700;margin-bottom:0.5rem}.login-subtitle{color:var(--text-secondary);margin-bottom:2rem}
        .empty-state{text-align:center;padding:3rem;color:var(--text-secondary)}.empty-state-icon{font-size:3rem;margin-bottom:1rem;opacity:0.5}
        .toast-container{position:fixed;bottom:2rem;right:2rem;z-index:2000;display:flex;flex-direction:column;gap:0.75rem}
        .toast{background:var(--bg-card);border:1px solid var(--border);border-radius:10px;padding:1rem 1.25rem;display:flex;align-items:center;gap:0.75rem;box-shadow:0 8px 24px rgba(0,0,0,0.3);animation:slideIn 0.3s ease;min-width:280px}
        @keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
        .toast.success{border-left:4px solid var(--success)}.toast.error{border-left:4px solid var(--danger)}.toast.warning{border-left:4px solid var(--warning)}
        .toast-icon{font-size:1.25rem}.toast.success .toast-icon{color:var(--success)}.toast.error .toast-icon{color:var(--danger)}.toast.warning .toast-icon{color:var(--warning)}
        .text-mono{font-family:'JetBrains Mono',monospace}.text-center{text-align:center}
        .mt-1{margin-top:0.5rem}.mt-2{margin-top:1rem}.mt-3{margin-top:1.5rem}.mb-2{margin-bottom:1rem}
        .flex{display:flex}.flex-between{justify-content:space-between}.gap-2{gap:1rem}.hidden{display:none!important}
        .hora-registro{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--bg-input);border-radius:8px;margin-bottom:1rem;flex-wrap:wrap}
        .hora-registro-label{font-size:0.8rem;color:var(--text-secondary)}.hora-registro-value{font-family:'JetBrains Mono',monospace;font-size:1.5rem;font-weight:600;color:var(--accent)}
        .turno-selector{display:flex;gap:0.5rem}
        .turno-btn{flex:1;padding:0.75rem;background:var(--bg-input);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center;transition:all 0.2s;color:var(--text-primary)}
        .turno-btn:hover{border-color:#3d7a52}.turno-btn.active{border-color:var(--accent);background:rgba(245,158,11,0.15)}
        .turno-btn-name{font-weight:600;font-size:0.9rem}.turno-btn-hours{font-size:0.75rem;color:var(--text-secondary);margin-top:0.25rem}
        .merma-type-selector{display:grid;grid-template-columns:repeat(4,1fr);gap:0.5rem}
        .merma-type-btn{padding:0.75rem 0.5rem;background:var(--bg-input);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center;font-size:0.8rem;font-weight:500;transition:all 0.2s;color:var(--text-primary)}
        .merma-type-btn:hover{border-color:#3d7a52}.merma-type-btn.active{border-color:var(--danger);background:rgba(220,38,38,0.15);color:#ef4444}
        @media(max-width:600px){.merma-type-selector{grid-template-columns:repeat(2,1fr)}}
    </style>
</head>
<body>
    <div id="loginScreen" class="login-screen">
        <div class="login-card">
            <div class="login-logo">ü¶É</div>
            <h1 class="login-title">Turky<span style="color:var(--accent)">.</span></h1>
            <p class="login-subtitle">Control de Productividad</p>
            <div class="form-group"><label class="form-label">Selecciona tu usuario</label><select id="loginUser" class="form-select"><option value="">-- Seleccionar --</option></select></div>
            <button class="btn btn-primary btn-block btn-lg" onclick="doLogin()">Ingresar</button>
        </div>
    </div>
    <div id="mainApp" class="hidden">
        <header class="header">
            <div class="logo"><div class="logo-icon">ü¶É</div><div class="logo-text">Turky<span>.</span></div></div>
            <div class="header-info">
                <div class="header-date" id="headerDate"></div>
                <div class="user-badge" onclick="logout()"><div class="user-avatar" id="userAvatar"></div><div class="user-info"><div class="user-name" id="userName"></div><div class="user-role" id="userRole"></div></div></div>
            </div>
        </header>
        <nav class="nav-container">
            <div class="nav-tabs">
                <button class="nav-tab active" data-screen="dashboard">üìä Dashboard</button>
                <button class="nav-tab" data-screen="ordenes">üìã √ìrdenes</button>
                <button class="nav-tab" data-screen="produccion">‚öôÔ∏è Producci√≥n</button>
                <button class="nav-tab" data-screen="controles">üéØ Controles</button>
                <button class="nav-tab" data-screen="mermas">üìâ Mermas</button>
                <button class="nav-tab" data-screen="productividad">üë• Productividad</button>
                <button class="nav-tab" data-screen="reportes">üìà Reportes</button>
            </div>
        </nav>
        <main class="main-content" id="mainContent"></main>
    </div>
    <div id="modalNuevaOrden" class="modal-overlay" onclick="closeModalOnOverlay(event)">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">Nueva Orden de Producci√≥n</h3><button class="modal-close" onclick="closeModal('modalNuevaOrden')">√ó</button></div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">L√≠nea de Producci√≥n</label><select id="ordenLinea" class="form-select" onchange="cargarProductosLinea()"><option value="">-- Seleccionar --</option><option value="CRUDOS">Crudos</option><option value="APANADOS">Apanados</option><option value="DERIVADOS">Derivados</option></select></div>
                <div class="form-group"><label class="form-label">Producto</label><select id="ordenProducto" class="form-select"><option value="">-- Primero selecciona l√≠nea --</option></select></div>
                <div class="form-row"><div class="form-group"><label class="form-label">Cantidad</label><input type="number" id="ordenCantidad" class="form-input" placeholder="0"></div><div class="form-group"><label class="form-label">Unidad</label><select id="ordenUnidad" class="form-select"><option value="kg">Kilogramos</option><option value="unidades">Unidades</option><option value="canastas">Canastas</option></select></div></div>
                <div class="form-row"><div class="form-group"><label class="form-label">Lote</label><input type="text" id="ordenLote" class="form-input" placeholder="L240126"></div><div class="form-group"><label class="form-label">Vencimiento</label><input type="date" id="ordenVencimiento" class="form-input"></div></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('modalNuevaOrden')">Cancelar</button><button class="btn btn-primary" onclick="guardarOrden()">Guardar</button></div>
        </div>
    </div>
    <div id="modalProductividad" class="modal-overlay" onclick="closeModalOnOverlay(event)">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">Registrar Productividad</h3><button class="modal-close" onclick="closeModal('modalProductividad')">√ó</button></div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">Operario</label><select id="prodOperario" class="form-select"><option value="">-- Seleccionar --</option></select></div>
                <div class="form-row"><div class="form-group"><label class="form-label">L√≠nea</label><select id="prodLineaOp" class="form-select" onchange="cargarEstacionesLinea()"><option value="">-- Seleccionar --</option><option value="CRUDOS">Crudos</option><option value="APANADOS">Apanados</option><option value="DERIVADOS">Derivados</option></select></div><div class="form-group"><label class="form-label">Estaci√≥n</label><select id="prodEstacionOp" class="form-select"><option value="">-- Primero selecciona l√≠nea --</option></select></div></div>
                <div class="form-row"><div class="form-group"><label class="form-label">Unidades Procesadas</label><input type="number" id="prodUnidadesOp" class="form-input" placeholder="0"></div><div class="form-group"><label class="form-label">Horas Trabajadas</label><input type="number" id="prodHorasOp" class="form-input" step="0.5" placeholder="0"></div></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('modalProductividad')">Cancelar</button><button class="btn btn-primary" onclick="guardarProductividad()">Guardar</button></div>
        </div>
    </div>
    <div class="toast-container" id="toastContainer"></div>
    <script>
// ==================== DATA ====================
const OPERARIOS = [
    { id: "1001400900", nombre: "NILSON ORTIZ GONZALES", cargo: "SUPERVISOR", planta: "CRUDOS", subproceso: "SUPERVISOR" },
    { id: "43202857", nombre: "PAULA ANDREA POSADA", cargo: "AUXILIAR", planta: "CRUDOS", subproceso: "LIDER PROCESO" },
    { id: "39326367", nombre: "OLGA LUCIA CADAVID", cargo: "AUXILIAR", planta: "CRUDOS", subproceso: "LIDER ACONDICIONADO" },
    { id: "5005008077", nombre: "KEYLIANA RINCON", cargo: "AUXILIAR", planta: "CRUDOS", subproceso: "LIDER PORCIONADO" },
    { id: "1055832518", nombre: "WILSON ALFREDIS CASTANO", cargo: "AUXILIAR", planta: "CRUDOS", subproceso: "LIDER EMPAQUE" },
    { id: "1216728039", nombre: "LAURA GISSELA BETANCUR", cargo: "AUXILIAR", planta: "CRUDOS", subproceso: "LIDER FLOWPACK" },
    { id: "1001598882", nombre: "SERGIO ALARCON", cargo: "AUXILIAR", planta: "CRUDOS", subproceso: "INYECCION" },
    { id: "1015278062", nombre: "LUISA AGUDELO", cargo: "AUXILIAR", planta: "CRUDOS", subproceso: "PORCIONADO" },
    { id: "DIEGO001", nombre: "DIEGO GALBAN", cargo: "LIDER", planta: "TODA LA PRODUCCION", subproceso: "LIDER GENERAL" },
    { id: "1007280051", nombre: "LUIS ARTETA", cargo: "AUXILIAR", planta: "APANADOS", subproceso: "FRITURA" },
    { id: "1017265834", nombre: "UBIELY GOMEZ", cargo: "AUXILIAR", planta: "APANADOS", subproceso: "LIDER EMPAQUE" },
    { id: "1017165357", nombre: "YILENA BORJA", cargo: "AUXILIAR", planta: "APANADOS", subproceso: "LIDER EMPAQUE" },
    { id: "1017925331", nombre: "MANUELA SOTO", cargo: "AUXILIAR", planta: "APANADOS", subproceso: "EMPAQUE" }
];
const PRODUCTOS = {
    DERIVADOS: [
        { codigo: "114003", descripcion: "TOCINETA PREMIUM x KG" },
        { codigo: "114005", descripcion: "TOCINETA SELECCIONADO x KG" },
        { codigo: "114012", descripcion: "TOCINO SELECCIONADO x KG" },
        { codigo: "114017", descripcion: "TOCINO PREMIUM x KG" }
    ],
    APANADOS: [
        { codigo: "111016", descripcion: "HAMB PECHUGA PANKO x90G x10und" },
        { codigo: "111001", descripcion: "CHICKEN TENDER PANKO x1KG" },
        { codigo: "111003", descripcion: "CRISPETAS POLLO PANKO x1KG" },
        { codigo: "111006", descripcion: "CUBOS POLLO PANKO x1KG" }
    ],
    CRUDOS: [
        { codigo: "113001", descripcion: "CHUZO CONTRA x250G x10und" },
        { codigo: "113004", descripcion: "CHUZO PECHUGA x1.85KG" },
        { codigo: "116012", descripcion: "FILETE POLLO UP x100G x10und" },
        { codigo: "118009", descripcion: "ALAS CORTADAS KP x KG" },
        { codigo: "118006", descripcion: "PECHUGA x1KG" }
    ]
};
const ESTACIONES = {
    CRUDOS: ["ACONDICIONADO", "PORCIONADO", "INYECCION", "SEPARADORA", "ADOBADO", "FLOWPACK", "EMPAQUE", "TUNEL"],
    APANADOS: ["FRITURA", "EMPAQUE", "BATIDO", "FORMADO", "PANKO", "ENFRIAMIENTO"],
    DERIVADOS: ["COCCION", "MOLDEADO", "ADOBO TOMBLER", "DESMOLDE", "TAJADO", "EMPAQUE"]
};
let currentUser = null, selectedLinea = null, selectedTurno = 1, selectedTipoMerma = 'merma', selectedOperarios = [];
let ordenes = [], produccion = [], controles = [], mermas = [], productividad = [];

const SCREENS = {
    dashboard: () => `<div class="grid-4"><div class="stat-card"><div class="stat-label">√ìrdenes Hoy</div><div class="stat-value" id="statOrdenes">0</div><div class="stat-change positive">‚Üë Activas</div></div><div class="stat-card crudos"><div class="stat-label">Producci√≥n Crudos</div><div class="stat-value" id="statCrudos">0 <span class="stat-unit">kg</span></div></div><div class="stat-card apanados"><div class="stat-label">Producci√≥n Apanados</div><div class="stat-value" id="statApanados">0 <span class="stat-unit">kg</span></div></div><div class="stat-card derivados"><div class="stat-label">Producci√≥n Derivados</div><div class="stat-value" id="statDerivados">0 <span class="stat-unit">kg</span></div></div></div><div class="grid-2"><div class="card"><div class="card-header"><h3 class="card-title"><span class="card-title-icon">‚ö°</span>Acciones R√°pidas</h3></div><div class="quick-actions"><div class="quick-action" onclick="showScreen('ordenes');openModal('modalNuevaOrden')"><div class="quick-action-icon">üìã</div><div class="quick-action-title">Nueva Orden</div><div class="quick-action-desc">Registrar orden</div></div><div class="quick-action" onclick="showScreen('produccion')"><div class="quick-action-icon">‚ñ∂Ô∏è</div><div class="quick-action-title">Producci√≥n</div><div class="quick-action-desc">Iniciar registro</div></div><div class="quick-action" onclick="showScreen('controles')"><div class="quick-action-icon">üå°Ô∏è</div><div class="quick-action-title">Control</div><div class="quick-action-desc">Registrar control</div></div><div class="quick-action" onclick="showScreen('mermas')"><div class="quick-action-icon">üìâ</div><div class="quick-action-title">Merma</div><div class="quick-action-desc">Registrar merma</div></div></div></div><div class="card"><div class="card-header"><h3 class="card-title"><span class="card-title-icon">üìä</span>Rendimiento del D√≠a</h3></div><div class="form-group"><label class="form-label">Crudos</label><div class="progress-bar"><div class="progress-fill" id="progressCrudos" style="width:0%"></div></div><div class="flex flex-between mt-1"><span class="text-mono" style="font-size:0.8rem;color:var(--crudos)" id="rendCrudos">0%</span><span style="font-size:0.75rem;color:var(--text-muted)">Meta: 85%</span></div></div><div class="form-group"><label class="form-label">Apanados</label><div class="progress-bar"><div class="progress-fill" id="progressApanados" style="width:0%;background:linear-gradient(90deg,var(--apanados),#fbbf24)"></div></div><div class="flex flex-between mt-1"><span class="text-mono" style="font-size:0.8rem;color:var(--apanados)" id="rendApanados">0%</span><span style="font-size:0.75rem;color:var(--text-muted)">Meta: 80%</span></div></div><div class="form-group"><label class="form-label">Derivados</label><div class="progress-bar"><div class="progress-fill" id="progressDerivados" style="width:0%;background:linear-gradient(90deg,var(--derivados),#a78bfa)"></div></div><div class="flex flex-between mt-1"><span class="text-mono" style="font-size:0.8rem;color:var(--derivados)" id="rendDerivados">0%</span><span style="font-size:0.75rem;color:var(--text-muted)">Meta: 75%</span></div></div></div></div><div class="card"><div class="card-header"><h3 class="card-title"><span class="card-title-icon">üìã</span>√ìrdenes Activas</h3></div><div class="table-container"><table class="table"><thead><tr><th>Orden</th><th>Producto</th><th>L√≠nea</th><th>Cantidad</th><th>Avance</th><th>Estado</th></tr></thead><tbody id="tableOrdenesActivas"><tr><td colspan="6" class="text-center" style="color:var(--text-muted);padding:2rem">No hay √≥rdenes activas</td></tr></tbody></table></div></div>`,
    ordenes: () => `<div class="card"><div class="card-header"><h3 class="card-title"><span class="card-title-icon">üìã</span>√ìrdenes de Producci√≥n</h3><button class="btn btn-primary" onclick="openModal('modalNuevaOrden')">+ Nueva Orden</button></div><div class="line-selector"><div class="line-btn active" onclick="filterOrdenes('todas',this)"><div class="line-btn-label">Ver</div><div class="line-btn-name" style="color:var(--text-primary)">Todas</div></div><div class="line-btn crudos" onclick="filterOrdenes('CRUDOS',this)"><div class="line-btn-label">L√≠nea</div><div class="line-btn-name">Crudos</div></div><div class="line-btn apanados" onclick="filterOrdenes('APANADOS',this)"><div class="line-btn-label">L√≠nea</div><div class="line-btn-name">Apanados</div></div><div class="line-btn derivados" onclick="filterOrdenes('DERIVADOS',this)"><div class="line-btn-label">L√≠nea</div><div class="line-btn-name">Derivados</div></div></div><div class="table-container"><table class="table"><thead><tr><th>C√≥digo</th><th>Producto</th><th>L√≠nea</th><th>Cantidad</th><th>Lote</th><th>Estado</th><th>Acciones</th></tr></thead><tbody id="tableOrdenes"></tbody></table></div></div>`,
    produccion: () => `<div class="card"><div class="card-header"><h3 class="card-title"><span class="card-title-icon">‚öôÔ∏è</span>Registro de Producci√≥n</h3></div><div class="hora-registro"><div><div class="hora-registro-label">Hora actual</div><div class="hora-registro-value" id="horaActual">--:--</div></div><div style="margin-left:auto"><label class="form-label">Turno</label><div class="turno-selector"><div class="turno-btn active" onclick="selectTurno(1,this)"><div class="turno-btn-name">Turno 1</div><div class="turno-btn-hours">6:00-15:50</div></div><div class="turno-btn" onclick="selectTurno(2,this)"><div class="turno-btn-name">Turno 2</div><div class="turno-btn-hours">9:00-18:50</div></div></div></div></div><div class="line-selector"><div class="line-btn crudos" onclick="selectLineaProduccion('CRUDOS',this)"><div class="line-btn-label">L√≠nea</div><div class="line-btn-name">Crudos</div></div><div class="line-btn apanados" onclick="selectLineaProduccion('APANADOS',this)"><div class="line-btn-label">L√≠nea</div><div class="line-btn-name">Apanados</div></div><div class="line-btn derivados" onclick="selectLineaProduccion('DERIVADOS',this)"><div class="line-btn-label">L√≠nea</div><div class="line-btn-name">Derivados</div></div></div><div id="produccionForm" class="hidden"><div class="form-row"><div class="form-group"><label class="form-label">Orden</label><select id="prodOrden" class="form-select"><option value="">-- Seleccionar --</option></select></div><div class="form-group"><label class="form-label">Hora Inicio</label><input type="time" id="prodHoraInicio" class="form-input"></div><div class="form-group"><label class="form-label">Hora Fin</label><input type="time" id="prodHoraFin" class="form-input"></div></div><div class="form-row"><div class="form-group"><label class="form-label">Peso Inicial (kg)</label><input type="number" id="prodPesoInicial" class="form-input" step="0.01" oninput="calcularRendimiento()"></div><div class="form-group"><label class="form-label">Peso Final (kg)</label><input type="number" id="prodPesoFinal" class="form-input" step="0.01" oninput="calcularRendimiento()"></div><div class="form-group"><label class="form-label">Rendimiento</label><input type="text" id="prodRendimiento" class="form-input" readonly value="---%"></div></div><div class="form-row"><div class="form-group"><label class="form-label">Unidades</label><input type="number" id="prodUnidades" class="form-input"></div><div class="form-group"><label class="form-label">Kg Producidos</label><input type="number" id="prodKg" class="form-input" step="0.01"></div></div><div class="form-group"><label class="form-label">Operarios</label><div class="operario-chips" id="operariosChips"></div></div><div class="flex gap-2 mt-3"><button class="btn btn-primary btn-lg" onclick="guardarProduccion()">üíæ Guardar</button><button class="btn btn-secondary btn-lg" onclick="limpiarProduccion()">üîÑ Limpiar</button></div></div><div id="produccionEmpty" class="empty-state"><div class="empty-state-icon">üëÜ</div><p>Selecciona una l√≠nea para comenzar</p></div></div><div class="card"><div class="card-header"><h3 class="card-title"><span class="card-title-icon">üìú</span>Registros del D√≠a</h3></div><div class="table-container"><table class="table"><thead><tr><th>Hora</th><th>L√≠nea</th><th>Producto</th><th>P.Inicial</th><th>P.Final</th><th>Rend.</th><th>Und</th></tr></thead><tbody id="tableProduccion"><tr><td colspan="7" class="text-center" style="color:var(--text-muted);padding:2rem">No hay registros</td></tr></tbody></table></div></div>`,
    controles: () => `<div class="card"><div class="card-header"><h3 class="card-title"><span class="card-title-icon">üéØ</span>Puntos de Control</h3></div><div class="line-selector"><div class="line-btn crudos" onclick="selectLineaControl('CRUDOS',this)"><div class="line-btn-label">L√≠nea</div><div class="line-btn-name">Crudos</div></div><div class="line-btn apanados" onclick="selectLineaControl('APANADOS',this)"><div class="line-btn-label">L√≠nea</div><div class="line-btn-name">Apanados</div></div><div class="line-btn derivados" onclick="selectLineaControl('DERIVADOS',this)"><div class="line-btn-label">L√≠nea</div><div class="line-btn-name">Derivados</div></div></div><div id="controlesCrudos" class="hidden"><h4 class="mb-2" style="color:var(--crudos)">Controles Crudos</h4><div class="form-row"><div class="form-group"><label class="form-label">Peso Inicial (kg)</label><input type="number" id="ctrlCrudosPesoInicial" class="form-input" step="0.01"></div><div class="form-group"><label class="form-label">Peso Final (kg)</label><input type="number" id="ctrlCrudosPesoFinal" class="form-input" step="0.01"></div><div class="form-group"><label class="form-label">% Inyecci√≥n</label><input type="number" id="ctrlCrudosInyeccion" class="form-input" step="0.01"></div></div><button class="btn btn-primary mt-2" onclick="guardarControl('CRUDOS')">üíæ Guardar</button></div><div id="controlesApanados" class="hidden"><h4 class="mb-2" style="color:var(--apanados)">Controles Apanados</h4><div class="form-row"><div class="form-group"><label class="form-label">Peso Inicial (kg)</label><input type="number" id="ctrlApanadosPesoInicial" class="form-input" step="0.01"></div><div class="form-group"><label class="form-label">Peso Final (kg)</label><input type="number" id="ctrlApanadosPesoFinal" class="form-input" step="0.01"></div></div><div class="form-row"><div class="form-group"><label class="form-label">Temperatura Aceite (¬∞C)</label><input type="number" id="ctrlApanadosTemp" class="form-input" step="0.1"></div><div class="form-group"><label class="form-label">Viscosidad</label><input type="text" id="ctrlApanadosViscosidad" class="form-input"></div></div><button class="btn btn-primary mt-2" onclick="guardarControl('APANADOS')">üíæ Guardar</button></div><div id="controlesDerivados" class="hidden"><h4 class="mb-2" style="color:var(--derivados)">Controles Derivados</h4><div class="form-row"><div class="form-group"><label class="form-label">Peso Inicial (kg)</label><input type="number" id="ctrlDerivadosPesoInicial" class="form-input" step="0.01"></div><div class="form-group"><label class="form-label">Peso Final (kg)</label><input type="number" id="ctrlDerivadosPesoFinal" class="form-input" step="0.01"></div></div><button class="btn btn-primary mt-2" onclick="guardarControl('DERIVADOS')">üíæ Guardar</button></div><div id="controlesEmpty" class="empty-state"><div class="empty-state-icon">üéØ</div><p>Selecciona una l√≠nea</p></div></div><div class="card"><div class="card-header"><h3 class="card-title"><span class="card-title-icon">üìú</span>Controles Hoy</h3></div><div class="table-container"><table class="table"><thead><tr><th>Hora</th><th>L√≠nea</th><th>Tipo</th><th>Valor</th><th>Usuario</th></tr></thead><tbody id="tableControles"><tr><td colspan="5" class="text-center" style="color:var(--text-muted);padding:2rem">No hay controles</td></tr></tbody></table></div></div>`,
    mermas: () => `<div class="card"><div class="card-header"><h3 class="card-title"><span class="card-title-icon">üìâ</span>Registro de Mermas</h3></div><div class="line-selector"><div class="line-btn crudos" onclick="selectLineaMerma('CRUDOS',this)"><div class="line-btn-label">L√≠nea</div><div class="line-btn-name">Crudos</div></div><div class="line-btn apanados" onclick="selectLineaMerma('APANADOS',this)"><div class="line-btn-label">L√≠nea</div><div class="line-btn-name">Apanados</div></div><div class="line-btn derivados" onclick="selectLineaMerma('DERIVADOS',this)"><div class="line-btn-label">L√≠nea</div><div class="line-btn-name">Derivados</div></div></div><div id="mermaForm" class="hidden"><div class="form-group"><label class="form-label">Tipo de Merma</label><div class="merma-type-selector"><div class="merma-type-btn active" onclick="selectTipoMerma('merma',this)">Merma</div><div class="merma-type-btn" onclick="selectTipoMerma('recorte',this)">Recorte</div><div class="merma-type-btn" onclick="selectTipoMerma('desperdicio',this)">Desperdicio</div><div class="merma-type-btn" onclick="selectTipoMerma('reproceso',this)">Reproceso</div></div></div><div class="form-row"><div class="form-group"><label class="form-label">Peso (kg)</label><input type="number" id="mermaPeso" class="form-input" step="0.01"></div><div class="form-group"><label class="form-label">Estaci√≥n</label><select id="mermaEstacion" class="form-select"><option value="">-- Seleccionar --</option></select></div></div><div class="form-group"><label class="form-label">Causa (opcional)</label><input type="text" id="mermaCausa" class="form-input"></div><button class="btn btn-danger btn-lg" onclick="guardarMerma()">üìâ Registrar Merma</button></div><div id="mermaEmpty" class="empty-state"><div class="empty-state-icon">üìâ</div><p>Selecciona una l√≠nea</p></div></div><div class="grid-4 mt-3"><div class="stat-card"><div class="stat-label">Total Merma</div><div class="stat-value" id="statMermaTotal">0 <span class="stat-unit">kg</span></div></div><div class="stat-card"><div class="stat-label">Recorte</div><div class="stat-value" id="statRecorte">0 <span class="stat-unit">kg</span></div></div><div class="stat-card"><div class="stat-label">Desperdicio</div><div class="stat-value" id="statDesperdicio">0 <span class="stat-unit">kg</span></div></div><div class="stat-card"><div class="stat-label">Reproceso</div><div class="stat-value" id="statReproceso">0 <span class="stat-unit">kg</span></div></div></div><div class="card mt-3"><div class="card-header"><h3 class="card-title"><span class="card-title-icon">üìú</span>Mermas Hoy</h3></div><div class="table-container"><table class="table"><thead><tr><th>Hora</th><th>L√≠nea</th><th>Tipo</th><th>Peso</th><th>Estaci√≥n</th><th>Causa</th></tr></thead><tbody id="tableMermas"><tr><td colspan="6" class="text-center" style="color:var(--text-muted);padding:2rem">No hay mermas</td></tr></tbody></table></div></div>`,
    productividad: () => `<div class="card"><div class="card-header"><h3 class="card-title"><span class="card-title-icon">üë•</span>Productividad por Operario</h3><button class="btn btn-primary" onclick="openModal('modalProductividad')">+ Registrar</button></div><div class="line-selector"><div class="line-btn active" onclick="filterProductividad('todas',this)"><div class="line-btn-label">Ver</div><div class="line-btn-name" style="color:var(--text-primary)">Todos</div></div><div class="line-btn crudos" onclick="filterProductividad('CRUDOS',this)"><div class="line-btn-label">L√≠nea</div><div class="line-btn-name">Crudos</div></div><div class="line-btn apanados" onclick="filterProductividad('APANADOS',this)"><div class="line-btn-label">L√≠nea</div><div class="line-btn-name">Apanados</div></div><div class="line-btn derivados" onclick="filterProductividad('DERIVADOS',this)"><div class="line-btn-label">L√≠nea</div><div class="line-btn-name">Derivados</div></div></div><div class="table-container"><table class="table"><thead><tr><th>Operario</th><th>L√≠nea</th><th>Estaci√≥n</th><th>Unidades</th><th>Horas</th><th>Und/Hora</th><th>Nivel</th></tr></thead><tbody id="tableProductividad"><tr><td colspan="7" class="text-center" style="color:var(--text-muted);padding:2rem">No hay registros</td></tr></tbody></table></div></div>`,
    reportes: () => `<div class="card"><div class="card-header"><h3 class="card-title"><span class="card-title-icon">üìà</span>Reportes y Exportaci√≥n</h3></div><div class="form-row mb-2"><div class="form-group"><label class="form-label">Fecha Desde</label><input type="date" id="reporteFechaDesde" class="form-input"></div><div class="form-group"><label class="form-label">Fecha Hasta</label><input type="date" id="reporteFechaHasta" class="form-input"></div><div class="form-group"><label class="form-label">L√≠nea</label><select id="reporteLinea" class="form-select"><option value="todas">Todas</option><option value="CRUDOS">Crudos</option><option value="APANADOS">Apanados</option><option value="DERIVADOS">Derivados</option></select></div></div><div class="quick-actions"><div class="quick-action" onclick="exportarReporte('produccion')"><div class="quick-action-icon">üìä</div><div class="quick-action-title">Producci√≥n</div><div class="quick-action-desc">Exportar CSV</div></div><div class="quick-action" onclick="exportarReporte('mermas')"><div class="quick-action-icon">üìâ</div><div class="quick-action-title">Mermas</div><div class="quick-action-desc">Exportar CSV</div></div><div class="quick-action" onclick="exportarReporte('productividad')"><div class="quick-action-icon">üë•</div><div class="quick-action-title">Productividad</div><div class="quick-action-desc">Exportar CSV</div></div><div class="quick-action" onclick="exportarReporte('controles')"><div class="quick-action-icon">üéØ</div><div class="quick-action-title">Controles</div><div class="quick-action-desc">Exportar CSV</div></div></div></div>`
};

document.addEventListener('DOMContentLoaded', initApp);
function initApp() { const s = document.getElementById('loginUser'); OPERARIOS.filter(o => o.cargo === 'SUPERVISOR' || o.cargo === 'LIDER' || o.subproceso.includes('LIDER')).forEach(op => s.innerHTML += `<option value="${op.id}">${op.nombre} - ${op.subproceso}</option>`); updateDateTime(); setInterval(updateDateTime, 1000); document.querySelectorAll('.nav-tab').forEach(tab => tab.addEventListener('click', () => showScreen(tab.dataset.screen))); loadData(); }
function updateDateTime() { const now = new Date(), hd = document.getElementById('headerDate'), ha = document.getElementById('horaActual'); if (hd) hd.textContent = now.toLocaleDateString('es-CO', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }); if (ha) ha.textContent = now.toLocaleTimeString('es-CO', { hour: '2-digit', minute: '2-digit' }); }
function doLogin() { const userId = document.getElementById('loginUser').value; if (!userId) { showToast('Selecciona un usuario', 'warning'); return; } currentUser = OPERARIOS.find(o => o.id === userId); document.getElementById('loginScreen').classList.add('hidden'); document.getElementById('mainApp').classList.remove('hidden'); document.getElementById('userAvatar').textContent = currentUser.nombre.split(' ').map(n => n[0]).slice(0, 2).join(''); document.getElementById('userName').textContent = currentUser.nombre.split(' ').slice(0, 2).join(' '); document.getElementById('userRole').textContent = currentUser.subproceso; showToast('Bienvenido, ' + currentUser.nombre.split(' ')[0], 'success'); showScreen('dashboard'); }
function logout() { if (confirm('¬øCerrar sesi√≥n?')) { currentUser = null; document.getElementById('mainApp').classList.add('hidden'); document.getElementById('loginScreen').classList.remove('hidden'); } }
function showScreen(screenId) { document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active')); const tab = document.querySelector('[data-screen="' + screenId + '"]'); if (tab) tab.classList.add('active'); document.getElementById('mainContent').innerHTML = SCREENS[screenId](); if (screenId === 'dashboard') refreshDashboard(); if (screenId === 'ordenes') refreshOrdenes(); if (screenId === 'produccion') { updateDateTime(); refreshProduccionTable(); } if (screenId === 'controles') refreshControlesTable(); if (screenId === 'mermas') refreshMermasStats(); if (screenId === 'productividad') refreshProductividadTable(); if (screenId === 'reportes') setTimeout(() => { const t = new Date().toISOString().split('T')[0]; const fd = document.getElementById('reporteFechaDesde'), fh = document.getElementById('reporteFechaHasta'); if (fd) fd.value = t; if (fh) fh.value = t; }, 50); populateSelects(); }
function populateSelects() { const s = document.getElementById('prodOperario'); if (s) { s.innerHTML = '<option value="">-- Seleccionar --</option>'; OPERARIOS.forEach(op => s.innerHTML += '<option value="' + op.id + '">' + op.nombre + '</option>'); } }
function openModal(id) { document.getElementById(id).classList.add('active'); }
function closeModal(id) { document.getElementById(id).classList.remove('active'); }
function closeModalOnOverlay(e) { if (e.target.classList.contains('modal-overlay')) e.target.classList.remove('active'); }
function showToast(msg, type) { type = type || 'success'; const c = document.getElementById('toastContainer'), icons = { success: '‚úì', error: '‚úï', warning: '‚ö†' }; const t = document.createElement('div'); t.className = 'toast ' + type; t.innerHTML = '<span class="toast-icon">' + icons[type] + '</span><span>' + msg + '</span>'; c.appendChild(t); setTimeout(() => { t.style.animation = 'slideIn 0.3s ease reverse'; setTimeout(() => t.remove(), 300); }, 3000); }
function saveData() { localStorage.setItem('turky_ordenes', JSON.stringify(ordenes)); localStorage.setItem('turky_produccion', JSON.stringify(produccion)); localStorage.setItem('turky_controles', JSON.stringify(controles)); localStorage.setItem('turky_mermas', JSON.stringify(mermas)); localStorage.setItem('turky_productividad', JSON.stringify(productividad)); }
function loadData() { ordenes = JSON.parse(localStorage.getItem('turky_ordenes') || '[]'); produccion = JSON.parse(localStorage.getItem('turky_produccion') || '[]'); controles = JSON.parse(localStorage.getItem('turky_controles') || '[]'); mermas = JSON.parse(localStorage.getItem('turky_mermas') || '[]'); productividad = JSON.parse(localStorage.getItem('turky_productividad') || '[]'); }
function cargarProductosLinea() { const l = document.getElementById('ordenLinea').value, s = document.getElementById('ordenProducto'); s.innerHTML = '<option value="">-- Seleccionar --</option>'; if (l && PRODUCTOS[l]) PRODUCTOS[l].forEach(p => s.innerHTML += '<option value="' + p.codigo + '">' + p.codigo + ' - ' + p.descripcion + '</option>'); }
function guardarOrden() { const l = document.getElementById('ordenLinea').value, pc = document.getElementById('ordenProducto').value, c = document.getElementById('ordenCantidad').value, u = document.getElementById('ordenUnidad').value, lo = document.getElementById('ordenLote').value, v = document.getElementById('ordenVencimiento').value; if (!l || !pc || !c || !lo) { showToast('Completa los campos', 'warning'); return; } const p = PRODUCTOS[l].find(x => x.codigo === pc); ordenes.push({ id: Date.now().toString(), fecha: new Date().toISOString().split('T')[0], linea: l, codigo: pc, descripcion: p.descripcion, cantidad: parseFloat(c), unidad: u, lote: lo, vencimiento: v, estado: 'pendiente', producido: 0 }); saveData(); closeModal('modalNuevaOrden'); showToast('Orden creada', 'success'); refreshOrdenes(); }
function refreshOrdenes() { const tb = document.getElementById('tableOrdenes'); if (!tb) return; const list = ordenes.filter(o => o.fecha === new Date().toISOString().split('T')[0]); tb.innerHTML = list.length === 0 ? '<tr><td colspan="7" class="text-center" style="color:var(--text-muted);padding:2rem">No hay √≥rdenes</td></tr>' : list.map(o => '<tr><td class="text-mono">' + o.codigo + '</td><td>' + o.descripcion.substring(0,20) + '...</td><td><span class="badge badge-' + o.linea.toLowerCase() + '">' + o.linea + '</span></td><td class="text-mono">' + o.cantidad + ' ' + o.unidad + '</td><td class="text-mono">' + o.lote + '</td><td><span class="badge badge-' + (o.estado==='completada'?'success':o.estado==='en_proceso'?'warning':'danger') + '">' + o.estado + '</span></td><td><button class="btn btn-sm btn-secondary" onclick="iniciarOrden(\'' + o.id + '\')">‚ñ∂Ô∏è</button></td></tr>').join(''); }
function filterOrdenes(f, btn) { document.querySelectorAll('#mainContent .line-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); const tb = document.getElementById('tableOrdenes'); let list = ordenes.filter(o => o.fecha === new Date().toISOString().split('T')[0]); if (f !== 'todas') list = list.filter(o => o.linea === f); tb.innerHTML = list.length === 0 ? '<tr><td colspan="7" class="text-center" style="color:var(--text-muted);padding:2rem">No hay √≥rdenes</td></tr>' : list.map(o => '<tr><td class="text-mono">' + o.codigo + '</td><td>' + o.descripcion.substring(0,20) + '...</td><td><span class="badge badge-' + o.linea.toLowerCase() + '">' + o.linea + '</span></td><td class="text-mono">' + o.cantidad + ' ' + o.unidad + '</td><td class="text-mono">' + o.lote + '</td><td><span class="badge badge-' + (o.estado==='completada'?'success':o.estado==='en_proceso'?'warning':'danger') + '">' + o.estado + '</span></td><td><button class="btn btn-sm btn-secondary" onclick="iniciarOrden(\'' + o.id + '\')">‚ñ∂Ô∏è</button></td></tr>').join(''); }
function iniciarOrden(id) { const o = ordenes.find(x => x.id === id); if (o) { o.estado = 'en_proceso'; saveData(); showScreen('produccion'); } }
function selectLineaProduccion(l, btn) { document.querySelectorAll('#mainContent .line-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); selectedLinea = l; document.getElementById('produccionEmpty').classList.add('hidden'); document.getElementById('produccionForm').classList.remove('hidden'); const s = document.getElementById('prodOrden'), list = ordenes.filter(o => o.linea === l && o.fecha === new Date().toISOString().split('T')[0] && o.estado !== 'completada'); s.innerHTML = '<option value="">-- Seleccionar --</option>'; list.forEach(o => s.innerHTML += '<option value="' + o.id + '">' + o.codigo + ' - ' + o.descripcion.substring(0,15) + '...</option>'); const cc = document.getElementById('operariosChips'), ops = OPERARIOS.filter(o => o.planta === l || o.planta === 'TODA LA PRODUCCION'); cc.innerHTML = ''; selectedOperarios = []; ops.forEach(op => { const i = op.nombre.split(' ').map(n => n[0]).slice(0,2).join(''); cc.innerHTML += '<div class="operario-chip" onclick="toggleOperario(\'' + op.id + '\',this)"><div class="operario-chip-avatar">' + i + '</div><span>' + op.nombre.split(' ').slice(0,2).join(' ') + '</span></div>'; }); document.getElementById('prodHoraInicio').value = new Date().toTimeString().slice(0,5); }
function selectTurno(t, btn) { document.querySelectorAll('.turno-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); selectedTurno = t; }
function toggleOperario(id, chip) { chip.classList.toggle('selected'); selectedOperarios = selectedOperarios.includes(id) ? selectedOperarios.filter(o => o !== id) : selectedOperarios.concat([id]); }
function calcularRendimiento() { const pi = parseFloat(document.getElementById('prodPesoInicial').value) || 0, pf = parseFloat(document.getElementById('prodPesoFinal').value) || 0; document.getElementById('prodRendimiento').value = pi > 0 && pf > 0 ? ((pf/pi)*100).toFixed(2)+'%' : '---%'; }
function guardarProduccion() { const oid = document.getElementById('prodOrden').value, hi = document.getElementById('prodHoraInicio').value, hf = document.getElementById('prodHoraFin').value, pi = parseFloat(document.getElementById('prodPesoInicial').value)||0, pf = parseFloat(document.getElementById('prodPesoFinal').value)||0, u = parseInt(document.getElementById('prodUnidades').value)||0, k = parseFloat(document.getElementById('prodKg').value)||0; if (!oid || !hi || pi === 0) { showToast('Completa los campos', 'warning'); return; } const o = ordenes.find(x => x.id === oid), r = pi > 0 ? ((pf/pi)*100).toFixed(2) : 0; produccion.push({ id: Date.now().toString(), fecha: new Date().toISOString().split('T')[0], ordenId: oid, linea: selectedLinea, turno: selectedTurno, horaInicio: hi, horaFin: hf, pesoInicial: pi, pesoFinal: pf, rendimiento: r, unidades: u, kg: k, operarios: selectedOperarios, producto: o ? o.descripcion : '', registradoPor: currentUser.id }); if (o) { o.producido += k || u; if (o.producido >= o.cantidad) o.estado = 'completada'; } saveData(); showToast('Producci√≥n registrada', 'success'); limpiarProduccion(); refreshProduccionTable(); }
function limpiarProduccion() { ['prodOrden','prodHoraFin','prodPesoInicial','prodPesoFinal','prodUnidades','prodKg'].forEach(id => { const e = document.getElementById(id); if(e) e.value = ''; }); document.getElementById('prodRendimiento').value = '---%'; selectedOperarios = []; document.querySelectorAll('.operario-chip').forEach(c => c.classList.remove('selected')); }
function refreshProduccionTable() { const tb = document.getElementById('tableProduccion'); if (!tb) return; const list = produccion.filter(p => p.fecha === new Date().toISOString().split('T')[0]); tb.innerHTML = list.length === 0 ? '<tr><td colspan="7" class="text-center" style="color:var(--text-muted);padding:2rem">No hay registros</td></tr>' : list.map(p => '<tr><td class="text-mono">' + p.horaInicio + '-' + (p.horaFin||'--') + '</td><td><span class="badge badge-' + p.linea.toLowerCase() + '">' + p.linea + '</span></td><td>' + (p.producto||'').substring(0,15) + '...</td><td class="text-mono">' + p.pesoInicial + 'kg</td><td class="text-mono">' + p.pesoFinal + 'kg</td><td class="text-mono">' + p.rendimiento + '%</td><td class="text-mono">' + p.unidades + '</td></tr>').join(''); }
function selectLineaControl(l, btn) { document.querySelectorAll('#mainContent .line-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); ['controlesEmpty','controlesCrudos','controlesApanados','controlesDerivados'].forEach(id => { const e = document.getElementById(id); if(e) e.classList.add('hidden'); }); const el = document.getElementById('controles' + l.charAt(0) + l.slice(1).toLowerCase()); if(el) el.classList.remove('hidden'); }
function guardarControl(l) { let v = {}; if (l === 'CRUDOS') v = { pesoInicial: (document.getElementById('ctrlCrudosPesoInicial')||{}).value, pesoFinal: (document.getElementById('ctrlCrudosPesoFinal')||{}).value, inyeccion: (document.getElementById('ctrlCrudosInyeccion')||{}).value }; else if (l === 'APANADOS') v = { pesoInicial: (document.getElementById('ctrlApanadosPesoInicial')||{}).value, pesoFinal: (document.getElementById('ctrlApanadosPesoFinal')||{}).value, temp: (document.getElementById('ctrlApanadosTemp')||{}).value, viscosidad: (document.getElementById('ctrlApanadosViscosidad')||{}).value }; else v = { pesoInicial: (document.getElementById('ctrlDerivadosPesoInicial')||{}).value, pesoFinal: (document.getElementById('ctrlDerivadosPesoFinal')||{}).value }; controles.push({ id: Date.now().toString(), fecha: new Date().toISOString().split('T')[0], hora: new Date().toLocaleTimeString('es-CO', { hour: '2-digit', minute: '2-digit' }), linea: l, tipo: 'Control ' + l, valores: v, registradoPor: currentUser.nombre }); saveData(); showToast('Control guardado', 'success'); refreshControlesTable(); }
function refreshControlesTable() { const tb = document.getElementById('tableControles'); if (!tb) return; const list = controles.filter(c => c.fecha === new Date().toISOString().split('T')[0]); tb.innerHTML = list.length === 0 ? '<tr><td colspan="5" class="text-center" style="color:var(--text-muted);padding:2rem">No hay controles</td></tr>' : list.map(c => { const val = c.valores.temp ? 'Temp: ' + c.valores.temp + '¬∞C' : c.valores.inyeccion ? 'Iny: ' + c.valores.inyeccion + '%' : 'PI: ' + c.valores.pesoInicial + 'kg'; return '<tr><td class="text-mono">' + c.hora + '</td><td><span class="badge badge-' + c.linea.toLowerCase() + '">' + c.linea + '</span></td><td>' + c.tipo + '</td><td class="text-mono">' + val + '</td><td>' + (c.registradoPor||'').split(' ').slice(0,2).join(' ') + '</td></tr>'; }).join(''); }
function selectLineaMerma(l, btn) { document.querySelectorAll('#mainContent .line-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); selectedLinea = l; document.getElementById('mermaEmpty').classList.add('hidden'); document.getElementById('mermaForm').classList.remove('hidden'); const s = document.getElementById('mermaEstacion'); s.innerHTML = '<option value="">-- Seleccionar --</option>'; ESTACIONES[l].forEach(e => s.innerHTML += '<option value="' + e + '">' + e + '</option>'); }
function selectTipoMerma(t, btn) { document.querySelectorAll('.merma-type-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); selectedTipoMerma = t; }
function guardarMerma() { const p = parseFloat(document.getElementById('mermaPeso').value)||0, e = document.getElementById('mermaEstacion').value, c = document.getElementById('mermaCausa').value; if (p === 0 || !e) { showToast('Completa peso y estaci√≥n', 'warning'); return; } mermas.push({ id: Date.now().toString(), fecha: new Date().toISOString().split('T')[0], hora: new Date().toLocaleTimeString('es-CO', { hour: '2-digit', minute: '2-digit' }), linea: selectedLinea, tipo: selectedTipoMerma, peso: p, estacion: e, causa: c, registradoPor: currentUser.id }); saveData(); showToast('Merma registrada', 'success'); document.getElementById('mermaPeso').value = ''; document.getElementById('mermaCausa').value = ''; refreshMermasStats(); }
function refreshMermasStats() { const t = new Date().toISOString().split('T')[0], list = mermas.filter(m => m.fecha === t); const tm = list.filter(m => m.tipo==='merma').reduce((s,m)=>s+m.peso,0), tr = list.filter(m => m.tipo==='recorte').reduce((s,m)=>s+m.peso,0), td = list.filter(m => m.tipo==='desperdicio').reduce((s,m)=>s+m.peso,0), tp = list.filter(m => m.tipo==='reproceso').reduce((s,m)=>s+m.peso,0); const e1=document.getElementById('statMermaTotal'),e2=document.getElementById('statRecorte'),e3=document.getElementById('statDesperdicio'),e4=document.getElementById('statReproceso'); if(e1)e1.innerHTML=(tm+tr+td).toFixed(1)+' <span class="stat-unit">kg</span>'; if(e2)e2.innerHTML=tr.toFixed(1)+' <span class="stat-unit">kg</span>'; if(e3)e3.innerHTML=td.toFixed(1)+' <span class="stat-unit">kg</span>'; if(e4)e4.innerHTML=tp.toFixed(1)+' <span class="stat-unit">kg</span>'; const tb=document.getElementById('tableMermas'); if(!tb)return; tb.innerHTML = list.length===0?'<tr><td colspan="6" class="text-center" style="color:var(--text-muted);padding:2rem">No hay mermas</td></tr>':list.map(m=>'<tr><td class="text-mono">'+m.hora+'</td><td><span class="badge badge-'+m.linea.toLowerCase()+'">'+m.linea+'</span></td><td><span class="badge badge-danger">'+m.tipo.toUpperCase()+'</span></td><td class="text-mono">'+m.peso+'kg</td><td>'+m.estacion+'</td><td>'+(m.causa||'-')+'</td></tr>').join(''); }
function cargarEstacionesLinea() { const l = document.getElementById('prodLineaOp').value, s = document.getElementById('prodEstacionOp'); s.innerHTML = '<option value="">-- Seleccionar --</option>'; if (l && ESTACIONES[l]) ESTACIONES[l].forEach(e => s.innerHTML += '<option value="' + e + '">' + e + '</option>'); }
function guardarProductividad() { const oid = document.getElementById('prodOperario').value, l = document.getElementById('prodLineaOp').value, e = document.getElementById('prodEstacionOp').value, u = parseInt(document.getElementById('prodUnidadesOp').value)||0, h = parseFloat(document.getElementById('prodHorasOp').value)||0; if (!oid || !l || !e || u===0 || h===0) { showToast('Completa todos los campos', 'warning'); return; } const op = OPERARIOS.find(o => o.id === oid), uh = (u/h).toFixed(1); productividad.push({ id: Date.now().toString(), fecha: new Date().toISOString().split('T')[0], operarioId: oid, nombre: op.nombre, linea: l, estacion: e, unidades: u, horas: h, unidadesHora: uh, registradoPor: currentUser.id }); saveData(); closeModal('modalProductividad'); showToast('Productividad registrada', 'success'); refreshProductividadTable(); }
function refreshProductividadTable() { const tb = document.getElementById('tableProductividad'); if (!tb) return; const list = productividad.filter(p => p.fecha === new Date().toISOString().split('T')[0]); tb.innerHTML = list.length===0?'<tr><td colspan="7" class="text-center" style="color:var(--text-muted);padding:2rem">No hay registros</td></tr>':list.map(p=>{ const lv=parseFloat(p.unidadesHora)>50?'success':parseFloat(p.unidadesHora)>30?'warning':'danger',lt=lv==='success'?'ALTO':lv==='warning'?'MEDIO':'BAJO'; return '<tr><td>'+p.nombre.split(' ').slice(0,2).join(' ')+'</td><td><span class="badge badge-'+p.linea.toLowerCase()+'">'+p.linea+'</span></td><td>'+p.estacion+'</td><td class="text-mono">'+p.unidades+'</td><td class="text-mono">'+p.horas+'h</td><td class="text-mono">'+p.unidadesHora+'</td><td><span class="badge badge-'+lv+'">'+lt+'</span></td></tr>'; }).join(''); }
function filterProductividad(f, btn) { document.querySelectorAll('#mainContent .line-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); const tb = document.getElementById('tableProductividad'); let list = productividad.filter(p => p.fecha === new Date().toISOString().split('T')[0]); if (f !== 'todas') list = list.filter(p => p.linea === f); tb.innerHTML = list.length===0?'<tr><td colspan="7" class="text-center" style="color:var(--text-muted);padding:2rem">No hay registros</td></tr>':list.map(p=>{ const lv=parseFloat(p.unidadesHora)>50?'success':parseFloat(p.unidadesHora)>30?'warning':'danger',lt=lv==='success'?'ALTO':lv==='warning'?'MEDIO':'BAJO'; return '<tr><td>'+p.nombre.split(' ').slice(0,2).join(' ')+'</td><td><span class="badge badge-'+p.linea.toLowerCase()+'">'+p.linea+'</span></td><td>'+p.estacion+'</td><td class="text-mono">'+p.unidades+'</td><td class="text-mono">'+p.horas+'h</td><td class="text-mono">'+p.unidadesHora+'</td><td><span class="badge badge-'+lv+'">'+lt+'</span></td></tr>'; }).join(''); }
function refreshDashboard() { const t = new Date().toISOString().split('T')[0], oh = ordenes.filter(o => o.fecha === t), ph = produccion.filter(p => p.fecha === t); const so = document.getElementById('statOrdenes'); if (so) so.textContent = oh.length; const kc = ph.filter(p => p.linea==='CRUDOS').reduce((s,p)=>s+(p.kg||0),0), ka = ph.filter(p => p.linea==='APANADOS').reduce((s,p)=>s+(p.kg||0),0), kd = ph.filter(p => p.linea==='DERIVADOS').reduce((s,p)=>s+(p.kg||0),0); const sc=document.getElementById('statCrudos'),sa=document.getElementById('statApanados'),sd=document.getElementById('statDerivados'); if(sc)sc.innerHTML=kc.toFixed(0)+' <span class="stat-unit">kg</span>'; if(sa)sa.innerHTML=ka.toFixed(0)+' <span class="stat-unit">kg</span>'; if(sd)sd.innerHTML=kd.toFixed(0)+' <span class="stat-unit">kg</span>'; const rc=ph.filter(p=>p.linea==='CRUDOS'&&p.rendimiento>0),ra=ph.filter(p=>p.linea==='APANADOS'&&p.rendimiento>0),rd=ph.filter(p=>p.linea==='DERIVADOS'&&p.rendimiento>0); const ac=rc.length>0?rc.reduce((s,p)=>s+parseFloat(p.rendimiento),0)/rc.length:0,aa=ra.length>0?ra.reduce((s,p)=>s+parseFloat(p.rendimiento),0)/ra.length:0,ad=rd.length>0?rd.reduce((s,p)=>s+parseFloat(p.rendimiento),0)/rd.length:0; const pc=document.getElementById('progressCrudos'),pa=document.getElementById('progressApanados'),pd=document.getElementById('progressDerivados'); if(pc)pc.style.width=Math.min(ac,100)+'%'; if(pa)pa.style.width=Math.min(aa,100)+'%'; if(pd)pd.style.width=Math.min(ad,100)+'%'; const erc=document.getElementById('rendCrudos'),era=document.getElementById('rendApanados'),erd=document.getElementById('rendDerivados'); if(erc)erc.textContent=ac.toFixed(1)+'%'; if(era)era.textContent=aa.toFixed(1)+'%'; if(erd)erd.textContent=ad.toFixed(1)+'%'; const tb=document.getElementById('tableOrdenesActivas'); if(!tb)return; const oa=oh.filter(o=>o.estado!=='completada'); tb.innerHTML = oa.length===0?'<tr><td colspan="6" class="text-center" style="color:var(--text-muted);padding:2rem">No hay √≥rdenes activas</td></tr>':oa.slice(0,5).map(o=>{ const av=o.cantidad>0?((o.producido/o.cantidad)*100).toFixed(0):0; return '<tr><td class="text-mono">'+o.lote+'</td><td>'+o.descripcion.substring(0,20)+'...</td><td><span class="badge badge-'+o.linea.toLowerCase()+'">'+o.linea+'</span></td><td class="text-mono">'+o.cantidad+' '+o.unidad+'</td><td><div class="progress-bar" style="width:80px;display:inline-block;vertical-align:middle"><div class="progress-fill" style="width:'+av+'%"></div></div> <span class="text-mono">'+av+'%</span></td><td><span class="badge badge-'+(o.estado==='en_proceso'?'warning':'danger')+'">'+o.estado+'</span></td></tr>'; }).join(''); }
function exportarReporte(tipo) { const d = (document.getElementById('reporteFechaDesde')||{}).value, h = (document.getElementById('reporteFechaHasta')||{}).value, l = (document.getElementById('reporteLinea')||{}).value; let data = tipo==='produccion'?produccion:tipo==='mermas'?mermas:tipo==='productividad'?productividad:controles; data = data.filter(x => x.fecha >= d && x.fecha <= h); if (l && l !== 'todas') data = data.filter(x => x.linea === l); if (data.length === 0) { showToast('No hay datos', 'warning'); return; } const headers = Object.keys(data[0]), csv = [headers.join(',')].concat(data.map(r => headers.map(hd => { let v = r[hd]; if (typeof v === 'object') v = JSON.stringify(v); return '"'+(v||'')+'"';}).join(','))).join('\n'); const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' }), link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = 'reporte_'+tipo+'_'+new Date().toISOString().split('T')[0]+'.csv'; link.click(); showToast('Reporte generado', 'success'); }
    </script>
</body>
</html>
