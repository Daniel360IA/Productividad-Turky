<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Turky v2</title>
<style>
:root{--primary:#1a5f2a;--accent:#f59e0b;--danger:#dc2626;--success:#16a34a;--warning:#ea580c;--bg-dark:#0c1810;--bg-card:#132419;--bg-input:#1a3324;--text-primary:#e8f5ec;--text-secondary:#9cb8a6;--text-muted:#5a7d66;--border:#2d5a3d;--crudos:#3b82f6;--apanados:#f59e0b;--derivados:#8b5cf6}
*{margin:0;padding:0;box-sizing:border-box}body{font-family:system-ui,sans-serif;background:var(--bg-dark);color:var(--text-primary);min-height:100vh}
.header{background:var(--bg-card);border-bottom:1px solid var(--border);padding:1rem;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100}
.logo{font-size:1.3rem;font-weight:700}.logo span{color:var(--accent)}
.header-info{display:flex;align-items:center;gap:1rem}.header-date{font-size:0.8rem;color:var(--text-secondary);background:var(--bg-input);padding:0.5rem 1rem;border-radius:8px}
.user-badge{display:flex;align-items:center;gap:0.5rem;background:var(--bg-input);padding:0.5rem 1rem;border-radius:8px;cursor:pointer}.user-avatar{width:30px;height:30px;background:var(--primary);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:0.75rem}.user-name{font-size:0.8rem;font-weight:600}.user-role{font-size:0.65rem;color:var(--text-secondary)}
.nav-container{background:var(--bg-card);border-bottom:1px solid var(--border);padding:0 1rem;overflow-x:auto}.nav-tabs{display:flex;gap:0.25rem}.nav-tab{padding:0.75rem;font-size:0.75rem;color:var(--text-secondary);background:transparent;border:none;cursor:pointer;white-space:nowrap}.nav-tab:hover{color:var(--text-primary)}.nav-tab.active{color:var(--accent);border-bottom:2px solid var(--accent)}
.main-content{padding:1rem;max-width:1400px;margin:0 auto}
.card{background:var(--bg-card);border:1px solid var(--border);border-radius:10px;padding:1rem;margin-bottom:1rem}.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding-bottom:0.75rem;border-bottom:1px solid var(--border);flex-wrap:wrap;gap:0.5rem}.card-title{font-size:0.95rem;font-weight:600}
.grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:0.75rem}@media(max-width:900px){.grid-4{grid-template-columns:repeat(2,1fr)}}@media(max-width:600px){.grid-2,.grid-4{grid-template-columns:1fr}}
.stat-card{background:var(--bg-input);border:1px solid var(--border);border-radius:10px;padding:1rem;position:relative}.stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--primary);border-radius:10px 10px 0 0}.stat-card.crudos::before{background:var(--crudos)}.stat-card.apanados::before{background:var(--apanados)}.stat-card.derivados::before{background:var(--derivados)}.stat-label{font-size:0.7rem;color:var(--text-secondary);text-transform:uppercase;margin-bottom:0.5rem}.stat-value{font-size:1.4rem;font-weight:700}.stat-unit{font-size:0.75rem;color:var(--text-secondary)}
.form-group{margin-bottom:0.75rem}.form-label{display:block;font-size:0.75rem;color:var(--text-secondary);margin-bottom:0.4rem}.form-input,.form-select{width:100%;padding:0.6rem;font-size:0.85rem;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;color:var(--text-primary)}.form-input:focus,.form-select:focus{outline:none;border-color:var(--primary)}.form-select option{background:var(--bg-dark)}.form-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:0.75rem}
.btn{padding:0.6rem 1.2rem;font-size:0.85rem;font-weight:600;border:none;border-radius:6px;cursor:pointer}.btn-primary{background:var(--primary);color:white}.btn-primary:hover{background:#2d8a42}.btn-secondary{background:var(--bg-input);color:var(--text-primary);border:1px solid var(--border)}.btn-danger{background:var(--danger);color:white}.btn-sm{padding:0.4rem 0.8rem;font-size:0.75rem}.btn-lg{padding:0.8rem 1.5rem}.btn-block{width:100%}
.table-container{overflow-x:auto;border-radius:6px;border:1px solid var(--border)}.table{width:100%;border-collapse:collapse;font-size:0.75rem}.table th{background:var(--bg-input);padding:0.6rem;text-align:left;font-weight:600;color:var(--text-secondary);text-transform:uppercase;font-size:0.65rem}.table td{padding:0.6rem;border-bottom:1px solid var(--border)}.table tr:last-child td{border-bottom:none}.table tr:hover td{background:rgba(26,95,42,0.1)}
.badge{display:inline-flex;padding:0.2rem 0.5rem;font-size:0.6rem;font-weight:600;border-radius:12px;text-transform:uppercase}.badge-crudos{background:rgba(59,130,246,0.2);color:var(--crudos)}.badge-apanados{background:rgba(245,158,11,0.2);color:var(--apanados)}.badge-derivados{background:rgba(139,92,246,0.2);color:var(--derivados)}.badge-success{background:rgba(22,163,74,0.2);color:var(--success)}.badge-warning{background:rgba(234,88,12,0.2);color:var(--warning)}.badge-danger{background:rgba(220,38,38,0.2);color:var(--danger)}
.line-selector{display:flex;gap:0.5rem;margin-bottom:1rem;flex-wrap:wrap}.line-btn{flex:1;min-width:70px;padding:0.6rem;background:var(--bg-input);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center}.line-btn.active{border-color:var(--primary)}.line-btn.crudos.active{border-color:var(--crudos);background:rgba(59,130,246,0.1)}.line-btn.apanados.active{border-color:var(--apanados);background:rgba(245,158,11,0.1)}.line-btn.derivados.active{border-color:var(--derivados);background:rgba(139,92,246,0.1)}.line-btn-label{font-size:0.55rem;color:var(--text-muted);text-transform:uppercase}.line-btn-name{font-size:0.8rem;font-weight:600}.line-btn.crudos .line-btn-name{color:var(--crudos)}.line-btn.apanados .line-btn-name{color:var(--apanados)}.line-btn.derivados .line-btn-name{color:var(--derivados)}
.progress-bar{height:6px;background:var(--bg-input);border-radius:3px;overflow:hidden}.progress-fill{height:100%;background:var(--primary);border-radius:3px}
.operario-chips{display:flex;flex-wrap:wrap;gap:0.4rem}.operario-chip{display:inline-flex;align-items:center;gap:0.4rem;padding:0.4rem 0.6rem;background:var(--bg-input);border:1px solid var(--border);border-radius:16px;font-size:0.75rem;cursor:pointer}.operario-chip.selected{background:var(--primary);border-color:var(--primary);color:white}.operario-chip-avatar{width:20px;height:20px;background:var(--border);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.55rem;font-weight:600}.operario-chip.selected .operario-chip-avatar{background:rgba(255,255,255,0.2)}
.quick-actions{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:0.75rem}.quick-action{background:var(--bg-input);border:1px solid var(--border);border-radius:10px;padding:0.75rem;cursor:pointer;text-align:center}.quick-action:hover{border-color:var(--primary)}.quick-action-icon{font-size:1.5rem;margin-bottom:0.4rem}.quick-action-title{font-weight:600;font-size:0.75rem}
.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;visibility:hidden;padding:1rem}.modal-overlay.active{opacity:1;visibility:visible}.modal{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;width:100%;max-width:600px;max-height:90vh;overflow-y:auto}.modal-header{display:flex;justify-content:space-between;align-items:center;padding:1rem;border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--bg-card)}.modal-title{font-size:1rem;font-weight:600}.modal-close{width:28px;height:28px;background:var(--bg-input);border:none;border-radius:6px;color:var(--text-secondary);cursor:pointer;font-size:1.1rem}.modal-close:hover{background:var(--danger);color:white}.modal-body{padding:1rem}.modal-footer{display:flex;justify-content:flex-end;gap:0.5rem;padding:1rem;border-top:1px solid var(--border)}
.login-screen{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:1rem}.login-card{background:var(--bg-card);border:1px solid var(--border);border-radius:16px;padding:2rem;width:100%;max-width:360px;text-align:center}.login-logo{font-size:3rem;margin-bottom:1rem}.login-title{font-size:1.4rem;font-weight:700;margin-bottom:0.5rem}.login-subtitle{color:var(--text-secondary);margin-bottom:1.5rem}
.empty-state{text-align:center;padding:2rem;color:var(--text-muted)}.empty-state-icon{font-size:2rem;margin-bottom:0.5rem}
.toast-container{position:fixed;bottom:1rem;right:1rem;z-index:2000}.toast{background:var(--bg-card);border:1px solid var(--border);border-radius:8px;padding:0.75rem 1rem;display:flex;align-items:center;gap:0.5rem;margin-top:0.5rem;animation:slideIn 0.3s}@keyframes slideIn{from{transform:translateX(100%)}to{transform:translateX(0)}}.toast.success{border-left:3px solid var(--success)}.toast.warning{border-left:3px solid var(--warning)}
.hidden{display:none!important}.mt-2{margin-top:1rem}.mb-2{margin-bottom:1rem}.flex{display:flex}.gap-2{gap:1rem}
.hora-registro{display:flex;align-items:center;gap:1rem;padding:0.75rem;background:var(--bg-input);border-radius:6px;margin-bottom:1rem;flex-wrap:wrap}.hora-registro-value{font-size:1.2rem;font-weight:600;color:var(--accent)}
.turno-selector{display:flex;gap:0.4rem}.turno-btn{padding:0.4rem 0.8rem;background:var(--bg-input);border:2px solid var(--border);border-radius:6px;cursor:pointer;text-align:center;color:var(--text-primary);font-size:0.75rem}.turno-btn.active{border-color:var(--accent);background:rgba(245,158,11,0.1)}
.merma-type-selector{display:grid;grid-template-columns:repeat(4,1fr);gap:0.4rem}.merma-type-btn{padding:0.5rem;background:var(--bg-input);border:2px solid var(--border);border-radius:6px;cursor:pointer;text-align:center;font-size:0.7rem;color:var(--text-primary)}.merma-type-btn.active{border-color:var(--danger);background:rgba(220,38,38,0.1);color:#ef4444}
.items-list{border:1px solid var(--border);border-radius:6px;max-height:150px;overflow-y:auto}.item-row{display:flex;align-items:center;gap:0.5rem;padding:0.5rem;border-bottom:1px solid var(--border);font-size:0.75rem}.item-row:last-child{border-bottom:none}.item-row .item-info{flex:1}.item-row .item-name{font-weight:500}.item-row .item-qty{font-size:0.7rem;color:var(--text-secondary)}.item-row .btn-remove{width:22px;height:22px;padding:0;border-radius:4px}
.info-box{background:rgba(245,158,11,0.1);border:1px solid rgba(245,158,11,0.3);border-radius:6px;padding:0.75rem;margin-bottom:1rem;font-size:0.8rem}.info-box strong{color:var(--accent)}
.consecutivo-display{display:flex;gap:0.75rem;margin-bottom:1rem;flex-wrap:wrap}.consecutivo-item{background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:0.5rem 0.75rem;text-align:center}.consecutivo-label{font-size:0.6rem;color:var(--text-muted);text-transform:uppercase}.consecutivo-value{font-size:1rem;font-weight:600;color:var(--accent)}
</style>
</head>
<body>
<div id="loginScreen" class="login-screen">
<div class="login-card">
<div class="login-logo">ü¶É</div>
<h1 class="login-title">Turky<span style="color:var(--accent)">.</span></h1>
<p class="login-subtitle">Control de Productividad v2</p>
<div class="form-group"><label class="form-label">Usuario</label><select id="loginUser" class="form-select"><option value="">-- Seleccionar --</option></select></div>
<button class="btn btn-primary btn-block btn-lg" onclick="doLogin()">Ingresar</button>
</div>
</div>
<div id="mainApp" class="hidden">
<header class="header"><div class="logo">ü¶É Turky<span>.</span></div><div class="header-info"><div class="header-date" id="headerDate"></div><div class="user-badge" onclick="logout()"><div class="user-avatar" id="userAvatar"></div><div><div class="user-name" id="userName"></div><div class="user-role" id="userRole"></div></div></div></div></header>
<nav class="nav-container"><div class="nav-tabs">
<button class="nav-tab active" data-screen="dashboard">üìä Dashboard</button>
<button class="nav-tab" data-screen="ordenes">üìã √ìrdenes</button>
<button class="nav-tab" data-screen="produccion">‚öôÔ∏è Producci√≥n</button>
<button class="nav-tab" data-screen="empaques">üì¶ Empaques</button>
<button class="nav-tab" data-screen="mermas">üìâ Mermas</button>
<button class="nav-tab" data-screen="productividad">üë• Productividad</button>
<button class="nav-tab" data-screen="reportes">üìà Reportes</button>
</div></nav>
<main class="main-content" id="mainContent"></main>
</div>
<div id="modalNuevaOrden" class="modal-overlay" onclick="if(event.target===this)closeModal('modalNuevaOrden')">
<div class="modal"><div class="modal-header"><h3 class="modal-title">Nueva Orden</h3><button class="modal-close" onclick="closeModal('modalNuevaOrden')">√ó</button></div>
<div class="modal-body">
<div class="consecutivo-display"><div class="consecutivo-item"><div class="consecutivo-label">Sistema</div><div class="consecutivo-value" id="ordenConsecSistema">OP-0001</div></div><div class="consecutivo-item" style="flex:1"><div class="consecutivo-label">Interno</div><input type="text" id="ordenConsecInterno" class="form-input" placeholder="2024-001" style="margin-top:0.25rem"></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">L√≠nea</label><select id="ordenLinea" class="form-select" onchange="cargarProductosLinea()"><option value="">Seleccionar</option><option value="CRUDOS">Crudos</option><option value="APANADOS">Apanados</option><option value="DERIVADOS">Derivados</option></select></div><div class="form-group"><label class="form-label">Fecha</label><input type="date" id="ordenFecha" class="form-input"></div></div>
<div style="background:var(--bg-input);padding:0.75rem;border-radius:6px;margin-bottom:0.75rem"><div style="font-size:0.8rem;font-weight:600;margin-bottom:0.5rem">‚ûï Agregar √çtem</div>
<div class="form-row"><div class="form-group" style="flex:2"><label class="form-label">Producto</label><select id="ordenProducto" class="form-select"><option value="">Selecciona l√≠nea</option></select></div><div class="form-group"><label class="form-label">Cantidad</label><input type="number" id="ordenCantidad" class="form-input"></div><div class="form-group"><label class="form-label">Unidad</label><select id="ordenUnidad" class="form-select"><option value="kg">kg</option><option value="und">und</option></select></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">Lote</label><input type="text" id="ordenLote" class="form-input"></div><div class="form-group"><label class="form-label">Venc.</label><input type="date" id="ordenVencimiento" class="form-input"></div><div class="form-group" style="display:flex;align-items:flex-end"><button class="btn btn-secondary btn-sm" onclick="agregarItemOrden()">+</button></div></div></div>
<div class="form-label">√çtems (<span id="itemsCount">0</span>)</div>
<div class="items-list" id="itemsOrdenList"><div class="empty-state" style="padding:1rem;font-size:0.8rem">No hay √≠tems</div></div>
</div>
<div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('modalNuevaOrden')">Cancelar</button><button class="btn btn-primary" onclick="guardarOrden()">üíæ Guardar</button></div>
</div></div>
<div id="modalEmpaque" class="modal-overlay" onclick="if(event.target===this)closeModal('modalEmpaque')">
<div class="modal"><div class="modal-header"><h3 class="modal-title">Registrar Empaque</h3><button class="modal-close" onclick="closeModal('modalEmpaque')">√ó</button></div>
<div class="modal-body">
<div class="form-group"><label class="form-label">Auxiliar</label><select id="empaqueOperario" class="form-select"><option value="">Seleccionar</option></select></div>
<div class="form-row"><div class="form-group"><label class="form-label">L√≠nea</label><select id="empaqueLinea" class="form-select" onchange="cargarProductosEmpaque()"><option value="">Seleccionar</option><option value="CRUDOS">Crudos</option><option value="APANADOS">Apanados</option><option value="DERIVADOS">Derivados</option></select></div><div class="form-group"><label class="form-label">Producto</label><select id="empaqueProducto" class="form-select"><option value="">Selecciona l√≠nea</option></select></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">Unidades</label><input type="number" id="empaqueUnidades" class="form-input"></div><div class="form-group"><label class="form-label">Kg</label><input type="number" id="empaqueKg" class="form-input" step="0.01"></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">H.Inicio</label><input type="time" id="empaqueHoraInicio" class="form-input"></div><div class="form-group"><label class="form-label">H.Fin</label><input type="time" id="empaqueHoraFin" class="form-input"></div></div>
</div>
<div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('modalEmpaque')">Cancelar</button><button class="btn btn-primary" onclick="guardarEmpaque()">üíæ Guardar</button></div>
</div></div>
<div id="modalProductividad" class="modal-overlay" onclick="if(event.target===this)closeModal('modalProductividad')">
<div class="modal"><div class="modal-header"><h3 class="modal-title">Registrar Productividad</h3><button class="modal-close" onclick="closeModal('modalProductividad')">√ó</button></div>
<div class="modal-body">
<div id="infoCoccionDerivados" class="info-box hidden">‚è±Ô∏è Cocci√≥n Derivados: <strong>2h 15min - 2h 30min</strong></div>
<div class="form-group"><label class="form-label">Operario</label><select id="prodOperario" class="form-select"><option value="">Seleccionar</option></select></div>
<div class="form-row"><div class="form-group"><label class="form-label">L√≠nea</label><select id="prodLineaOp" class="form-select" onchange="cargarEstacionesLinea();mostrarInfoCoccion()"><option value="">Seleccionar</option><option value="CRUDOS">Crudos</option><option value="APANADOS">Apanados</option><option value="DERIVADOS">Derivados</option></select></div><div class="form-group"><label class="form-label">Estaci√≥n</label><select id="prodEstacionOp" class="form-select"><option value="">Selecciona l√≠nea</option></select></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">Unidades</label><input type="number" id="prodUnidadesOp" class="form-input"></div><div class="form-group"><label class="form-label">Horas</label><input type="number" id="prodHorasOp" class="form-input" step="0.25"></div></div>
</div>
<div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('modalProductividad')">Cancelar</button><button class="btn btn-primary" onclick="guardarProductividad()">üíæ Guardar</button></div>
</div></div>
<div class="toast-container" id="toastContainer"></div>
<script>
const OPERARIOS=[{id:"1",nombre:"NILSON ORTIZ",cargo:"SUPERVISOR",planta:"CRUDOS",subproceso:"SUPERVISOR"},{id:"2",nombre:"PAULA POSADA",cargo:"AUXILIAR",planta:"CRUDOS",subproceso:"LIDER PROCESO"},{id:"3",nombre:"DIEGO GALBAN",cargo:"LIDER",planta:"TODA LA PRODUCCION",subproceso:"LIDER GENERAL"},{id:"4",nombre:"LUIS ARTETA",cargo:"AUXILIAR",planta:"APANADOS",subproceso:"FRITURA"},{id:"5",nombre:"UBIELY GOMEZ",cargo:"AUXILIAR",planta:"APANADOS",subproceso:"LIDER EMPAQUE"},{id:"6",nombre:"CARLOS MARTINEZ",cargo:"AUXILIAR",planta:"DERIVADOS",subproceso:"MOLIDO"},{id:"7",nombre:"MARIA LOPEZ",cargo:"AUXILIAR",planta:"DERIVADOS",subproceso:"EMPAQUE"}];
const PRODUCTOS={DERIVADOS:[{codigo:"114003",descripcion:"TOCINETA PREMIUM"},{codigo:"114005",descripcion:"TOCINETA SELECCIONADO"},{codigo:"114012",descripcion:"TOCINO SELECCIONADO"}],APANADOS:[{codigo:"111016",descripcion:"HAMB PECHUGA PANKO"},{codigo:"111001",descripcion:"CHICKEN TENDER"},{codigo:"111003",descripcion:"CRISPETAS POLLO"}],CRUDOS:[{codigo:"113001",descripcion:"CHUZO CONTRA"},{codigo:"113004",descripcion:"CHUZO PECHUGA"},{codigo:"118006",descripcion:"PECHUGA"}]};
const ESTACIONES={CRUDOS:["ACONDICIONADO","PORCIONADO","INYECCION","SEPARADORA","ADOBADO","FLOWPACK","EMPAQUE","TUNEL"],APANADOS:["FRITURA","EMPAQUE","BATIDO","FORMADO","PANKO","ENFRIAMIENTO"],DERIVADOS:["MOLIDO","TOMBLEADO","EMBUTIDO","MOLDEADO","COCCION","DESMOLDE","EMPAQUE"]};
let currentUser=null,selectedLinea=null,selectedTurno=1,selectedTipoMerma='merma',selectedOperarios=[];
let ordenes=[],produccion=[],mermas=[],productividad=[],empaques=[];
let itemsOrdenTemp=[],consecutivoSistema=1;
const SCREENS={
dashboard:()=>`<div class="grid-4"><div class="stat-card"><div class="stat-label">√ìrdenes Hoy</div><div class="stat-value" id="statOrdenes">0</div></div><div class="stat-card crudos"><div class="stat-label">Crudos</div><div class="stat-value" id="statCrudos">0<span class="stat-unit">kg</span></div></div><div class="stat-card apanados"><div class="stat-label">Apanados</div><div class="stat-value" id="statApanados">0<span class="stat-unit">kg</span></div></div><div class="stat-card derivados"><div class="stat-label">Derivados</div><div class="stat-value" id="statDerivados">0<span class="stat-unit">kg</span></div></div></div><div class="grid-2"><div class="card"><div class="card-header"><h3 class="card-title">‚ö° Acciones</h3></div><div class="quick-actions"><div class="quick-action" onclick="abrirNuevaOrden()"><div class="quick-action-icon">üìã</div><div class="quick-action-title">Nueva Orden</div></div><div class="quick-action" onclick="showScreen('produccion')"><div class="quick-action-icon">‚ñ∂Ô∏è</div><div class="quick-action-title">Producci√≥n</div></div><div class="quick-action" onclick="showScreen('empaques')"><div class="quick-action-icon">üì¶</div><div class="quick-action-title">Empaques</div></div><div class="quick-action" onclick="showScreen('mermas')"><div class="quick-action-icon">üìâ</div><div class="quick-action-title">Mermas</div></div></div></div><div class="card"><div class="card-header"><h3 class="card-title">üìä Rendimiento</h3></div><div class="form-group"><label class="form-label">Crudos</label><div class="progress-bar"><div class="progress-fill" id="progressCrudos" style="width:0%"></div></div><span style="font-size:0.7rem" id="rendCrudos">0%</span></div><div class="form-group"><label class="form-label">Apanados</label><div class="progress-bar"><div class="progress-fill" id="progressApanados" style="width:0%;background:var(--apanados)"></div></div><span style="font-size:0.7rem" id="rendApanados">0%</span></div><div class="form-group"><label class="form-label">Derivados</label><div class="progress-bar"><div class="progress-fill" id="progressDerivados" style="width:0%;background:var(--derivados)"></div></div><span style="font-size:0.7rem" id="rendDerivados">0%</span></div></div></div><div class="card"><div class="card-header"><h3 class="card-title">üìã √ìrdenes Activas</h3></div><div class="table-container"><table class="table"><thead><tr><th>Sistema</th><th>Interno</th><th>L√≠nea</th><th>Items</th><th>Estado</th></tr></thead><tbody id="tableOrdenesActivas"><tr><td colspan="5" class="empty-state">No hay √≥rdenes</td></tr></tbody></table></div></div>`,
ordenes:()=>`<div class="card"><div class="card-header"><h3 class="card-title">üìã √ìrdenes</h3><button class="btn btn-primary btn-sm" onclick="abrirNuevaOrden()">+ Nueva</button></div><div class="line-selector"><div class="line-btn active" onclick="filterOrdenes('todas',this)"><div class="line-btn-name">Todas</div></div><div class="line-btn crudos" onclick="filterOrdenes('CRUDOS',this)"><div class="line-btn-name">Crudos</div></div><div class="line-btn apanados" onclick="filterOrdenes('APANADOS',this)"><div class="line-btn-name">Apanados</div></div><div class="line-btn derivados" onclick="filterOrdenes('DERIVADOS',this)"><div class="line-btn-name">Derivados</div></div></div><div class="table-container"><table class="table"><thead><tr><th>Sistema</th><th>Interno</th><th>L√≠nea</th><th>Items</th><th>Estado</th></tr></thead><tbody id="tableOrdenes"></tbody></table></div></div>`,
produccion:()=>`<div class="card"><div class="card-header"><h3 class="card-title">‚öôÔ∏è Producci√≥n</h3></div><div class="hora-registro"><span>Hora:</span><span class="hora-registro-value" id="horaActual">--:--</span><div style="margin-left:auto" class="turno-selector"><div class="turno-btn active" onclick="selectTurno(1,this)">T1</div><div class="turno-btn" onclick="selectTurno(2,this)">T2</div></div></div><div class="line-selector"><div class="line-btn crudos" onclick="selectLineaProduccion('CRUDOS',this)"><div class="line-btn-name">Crudos</div></div><div class="line-btn apanados" onclick="selectLineaProduccion('APANADOS',this)"><div class="line-btn-name">Apanados</div></div><div class="line-btn derivados" onclick="selectLineaProduccion('DERIVADOS',this)"><div class="line-btn-name">Derivados</div></div></div><div id="produccionForm" class="hidden"><div id="infoCoccionProd" class="info-box hidden">‚è±Ô∏è Cocci√≥n Derivados: <strong>2h15min - 2h30min</strong></div><div class="form-row"><div class="form-group"><label class="form-label">Orden</label><select id="prodOrden" class="form-select"><option value="">Seleccionar</option></select></div><div class="form-group"><label class="form-label">H.Inicio</label><input type="time" id="prodHoraInicio" class="form-input"></div><div class="form-group"><label class="form-label">H.Fin</label><input type="time" id="prodHoraFin" class="form-input"></div></div><div class="form-row"><div class="form-group"><label class="form-label">Peso Inicial</label><input type="number" id="prodPesoInicial" class="form-input" step="0.01" oninput="calcRendimiento()"></div><div class="form-group"><label class="form-label">Peso Final</label><input type="number" id="prodPesoFinal" class="form-input" step="0.01" oninput="calcRendimiento()"></div><div class="form-group"><label class="form-label">Rend.</label><input type="text" id="prodRendimiento" class="form-input" readonly value="---%"></div></div><div class="form-row"><div class="form-group"><label class="form-label">Unidades</label><input type="number" id="prodUnidades" class="form-input"></div><div class="form-group"><label class="form-label">Kg</label><input type="number" id="prodKg" class="form-input" step="0.01"></div></div><div class="form-group"><label class="form-label">Operarios</label><div class="operario-chips" id="operariosChips"></div></div><div class="flex gap-2 mt-2"><button class="btn btn-primary" onclick="guardarProduccion()">üíæ Guardar</button><button class="btn btn-secondary" onclick="limpiarProduccion()">üîÑ</button></div></div><div id="produccionEmpty" class="empty-state"><div class="empty-state-icon">üëÜ</div><p>Selecciona l√≠nea</p></div></div><div class="card"><div class="card-header"><h3 class="card-title">üìú Registros Hoy</h3></div><div class="table-container"><table class="table"><thead><tr><th>Hora</th><th>L√≠nea</th><th>Orden</th><th>PI</th><th>PF</th><th>Rend</th></tr></thead><tbody id="tableProduccion"><tr><td colspan="6" class="empty-state">No hay registros</td></tr></tbody></table></div></div>`,
empaques:()=>`<div class="card"><div class="card-header"><h3 class="card-title">üì¶ Empaques</h3><button class="btn btn-primary btn-sm" onclick="abrirModalEmpaque()">+ Registrar</button></div><div class="line-selector"><div class="line-btn active" onclick="filterEmpaques('todas',this)"><div class="line-btn-name">Todas</div></div><div class="line-btn crudos" onclick="filterEmpaques('CRUDOS',this)"><div class="line-btn-name">Crudos</div></div><div class="line-btn apanados" onclick="filterEmpaques('APANADOS',this)"><div class="line-btn-name">Apanados</div></div><div class="line-btn derivados" onclick="filterEmpaques('DERIVADOS',this)"><div class="line-btn-name">Derivados</div></div></div><div class="table-container"><table class="table"><thead><tr><th>Auxiliar</th><th>L√≠nea</th><th>Producto</th><th>Und</th><th>Kg</th><th>Hora</th></tr></thead><tbody id="tableEmpaques"><tr><td colspan="6" class="empty-state">No hay empaques</td></tr></tbody></table></div></div><div class="grid-4 mt-2"><div class="stat-card crudos"><div class="stat-label">Crudos</div><div class="stat-value" id="statEmpCrudos">0</div></div><div class="stat-card apanados"><div class="stat-label">Apanados</div><div class="stat-value" id="statEmpApanados">0</div></div><div class="stat-card derivados"><div class="stat-label">Derivados</div><div class="stat-value" id="statEmpDerivados">0</div></div><div class="stat-card"><div class="stat-label">Total Kg</div><div class="stat-value" id="statEmpKgTotal">0</div></div></div>`,
mermas:()=>`<div class="card"><div class="card-header"><h3 class="card-title">üìâ Mermas</h3></div><div class="line-selector"><div class="line-btn crudos" onclick="selectLineaMerma('CRUDOS',this)"><div class="line-btn-name">Crudos</div></div><div class="line-btn apanados" onclick="selectLineaMerma('APANADOS',this)"><div class="line-btn-name">Apanados</div></div><div class="line-btn derivados" onclick="selectLineaMerma('DERIVADOS',this)"><div class="line-btn-name">Derivados</div></div></div><div id="mermaForm" class="hidden"><div class="form-group"><label class="form-label">Tipo</label><div class="merma-type-selector"><div class="merma-type-btn active" onclick="selectTipoMerma('merma',this)">Merma</div><div class="merma-type-btn" onclick="selectTipoMerma('recorte',this)">Recorte</div><div class="merma-type-btn" onclick="selectTipoMerma('desperdicio',this)">Desperdicio</div><div class="merma-type-btn" onclick="selectTipoMerma('reproceso',this)">Reproceso</div></div></div><div class="form-row"><div class="form-group"><label class="form-label">Peso kg</label><input type="number" id="mermaPeso" class="form-input" step="0.01"></div><div class="form-group"><label class="form-label">Estaci√≥n</label><select id="mermaEstacion" class="form-select"><option value="">Seleccionar</option></select></div></div><div class="form-group"><label class="form-label">Causa</label><input type="text" id="mermaCausa" class="form-input"></div><button class="btn btn-danger" onclick="guardarMerma()">üìâ Registrar</button></div><div id="mermaEmpty" class="empty-state"><div class="empty-state-icon">üìâ</div><p>Selecciona l√≠nea</p></div></div><div class="grid-4 mt-2"><div class="stat-card"><div class="stat-label">Total</div><div class="stat-value" id="statMermaTotal">0kg</div></div><div class="stat-card"><div class="stat-label">Recorte</div><div class="stat-value" id="statRecorte">0kg</div></div><div class="stat-card"><div class="stat-label">Desperdicio</div><div class="stat-value" id="statDesperdicio">0kg</div></div><div class="stat-card"><div class="stat-label">Reproceso</div><div class="stat-value" id="statReproceso">0kg</div></div></div><div class="card mt-2"><div class="table-container"><table class="table"><thead><tr><th>Hora</th><th>L√≠nea</th><th>Tipo</th><th>Peso</th><th>Estaci√≥n</th></tr></thead><tbody id="tableMermas"><tr><td colspan="5" class="empty-state">No hay mermas</td></tr></tbody></table></div></div>`,
productividad:()=>`<div class="card"><div class="card-header"><h3 class="card-title">üë• Productividad</h3><button class="btn btn-primary btn-sm" onclick="openModal('modalProductividad')">+ Registrar</button></div><div class="line-selector"><div class="line-btn active" onclick="filterProductividad('todas',this)"><div class="line-btn-name">Todos</div></div><div class="line-btn crudos" onclick="filterProductividad('CRUDOS',this)"><div class="line-btn-name">Crudos</div></div><div class="line-btn apanados" onclick="filterProductividad('APANADOS',this)"><div class="line-btn-name">Apanados</div></div><div class="line-btn derivados" onclick="filterProductividad('DERIVADOS',this)"><div class="line-btn-name">Derivados</div></div></div><div class="table-container"><table class="table"><thead><tr><th>Operario</th><th>L√≠nea</th><th>Estaci√≥n</th><th>Und</th><th>Horas</th><th>Und/H</th><th>Nivel</th></tr></thead><tbody id="tableProductividad"><tr><td colspan="7" class="empty-state">No hay registros</td></tr></tbody></table></div></div>`,
reportes:()=>`<div class="card"><div class="card-header"><h3 class="card-title">üìà Reportes</h3></div><div class="form-row mb-2"><div class="form-group"><label class="form-label">Desde</label><input type="date" id="reporteFechaDesde" class="form-input"></div><div class="form-group"><label class="form-label">Hasta</label><input type="date" id="reporteFechaHasta" class="form-input"></div><div class="form-group"><label class="form-label">L√≠nea</label><select id="reporteLinea" class="form-select"><option value="todas">Todas</option><option value="CRUDOS">Crudos</option><option value="APANADOS">Apanados</option><option value="DERIVADOS">Derivados</option></select></div></div><div class="quick-actions"><div class="quick-action" onclick="exportarReporte('ordenes')"><div class="quick-action-icon">üìã</div><div class="quick-action-title">√ìrdenes</div></div><div class="quick-action" onclick="exportarReporte('produccion')"><div class="quick-action-icon">üìä</div><div class="quick-action-title">Producci√≥n</div></div><div class="quick-action" onclick="exportarReporte('empaques')"><div class="quick-action-icon">üì¶</div><div class="quick-action-title">Empaques</div></div><div class="quick-action" onclick="exportarReporte('mermas')"><div class="quick-action-icon">üìâ</div><div class="quick-action-title">Mermas</div></div><div class="quick-action" onclick="exportarReporte('productividad')"><div class="quick-action-icon">üë•</div><div class="quick-action-title">Productividad</div></div></div></div>`
};
document.addEventListener('DOMContentLoaded',initApp);
function initApp(){const s=document.getElementById('loginUser');OPERARIOS.filter(o=>o.cargo==='SUPERVISOR'||o.cargo==='LIDER'||o.subproceso.includes('LIDER')).forEach(op=>s.innerHTML+='<option value="'+op.id+'">'+op.nombre+'</option>');updateDateTime();setInterval(updateDateTime,1000);document.querySelectorAll('.nav-tab').forEach(tab=>tab.addEventListener('click',()=>showScreen(tab.dataset.screen)));loadData();}
function updateDateTime(){const now=new Date(),hd=document.getElementById('headerDate'),ha=document.getElementById('horaActual');if(hd)hd.textContent=now.toLocaleDateString('es-CO',{weekday:'short',month:'short',day:'numeric'});if(ha)ha.textContent=now.toLocaleTimeString('es-CO',{hour:'2-digit',minute:'2-digit'});}
function doLogin(){const userId=document.getElementById('loginUser').value;if(!userId){showToast('Selecciona usuario','warning');return;}currentUser=OPERARIOS.find(o=>o.id===userId);document.getElementById('loginScreen').classList.add('hidden');document.getElementById('mainApp').classList.remove('hidden');document.getElementById('userAvatar').textContent=currentUser.nombre.split(' ').map(n=>n[0]).slice(0,2).join('');document.getElementById('userName').textContent=currentUser.nombre;document.getElementById('userRole').textContent=currentUser.subproceso;showToast('Bienvenido','success');showScreen('dashboard');}
function logout(){if(confirm('¬øCerrar sesi√≥n?')){currentUser=null;document.getElementById('mainApp').classList.add('hidden');document.getElementById('loginScreen').classList.remove('hidden');}}
function showScreen(screenId){document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));const tab=document.querySelector('[data-screen="'+screenId+'"]');if(tab)tab.classList.add('active');document.getElementById('mainContent').innerHTML=SCREENS[screenId]();if(screenId==='dashboard')refreshDashboard();if(screenId==='ordenes')refreshOrdenes();if(screenId==='produccion'){updateDateTime();refreshProduccionTable();}if(screenId==='empaques')refreshEmpaques();if(screenId==='mermas')refreshMermasStats();if(screenId==='productividad')refreshProductividadTable();if(screenId==='reportes')setTimeout(()=>{const t=new Date().toISOString().split('T')[0];const fd=document.getElementById('reporteFechaDesde'),fh=document.getElementById('reporteFechaHasta');if(fd)fd.value=t;if(fh)fh.value=t;},50);populateSelects();}
function populateSelects(){const s=document.getElementById('prodOperario');if(s){s.innerHTML='<option value="">Seleccionar</option>';OPERARIOS.forEach(op=>s.innerHTML+='<option value="'+op.id+'">'+op.nombre+'</option>');}const e=document.getElementById('empaqueOperario');if(e){e.innerHTML='<option value="">Seleccionar</option>';OPERARIOS.forEach(op=>e.innerHTML+='<option value="'+op.id+'">'+op.nombre+'</option>');}}
function openModal(id){document.getElementById(id).classList.add('active');}
function closeModal(id){document.getElementById(id).classList.remove('active');}
function showToast(msg,type){type=type||'success';const c=document.getElementById('toastContainer');const t=document.createElement('div');t.className='toast '+type;t.innerHTML='<span>'+(type==='success'?'‚úì':'‚ö†')+'</span><span>'+msg+'</span>';c.appendChild(t);setTimeout(()=>t.remove(),3000);}
function saveData(){localStorage.setItem('turky_ordenes',JSON.stringify(ordenes));localStorage.setItem('turky_produccion',JSON.stringify(produccion));localStorage.setItem('turky_mermas',JSON.stringify(mermas));localStorage.setItem('turky_productividad',JSON.stringify(productividad));localStorage.setItem('turky_empaques',JSON.stringify(empaques));localStorage.setItem('turky_consecutivo',consecutivoSistema.toString());}
function loadData(){ordenes=JSON.parse(localStorage.getItem('turky_ordenes')||'[]');produccion=JSON.parse(localStorage.getItem('turky_produccion')||'[]');mermas=JSON.parse(localStorage.getItem('turky_mermas')||'[]');productividad=JSON.parse(localStorage.getItem('turky_productividad')||'[]');empaques=JSON.parse(localStorage.getItem('turky_empaques')||'[]');consecutivoSistema=parseInt(localStorage.getItem('turky_consecutivo')||'1');}
function generarConsecSistema(){return 'OP-'+String(consecutivoSistema).padStart(4,'0');}
function abrirNuevaOrden(){itemsOrdenTemp=[];document.getElementById('ordenConsecSistema').textContent=generarConsecSistema();document.getElementById('ordenConsecInterno').value='';document.getElementById('ordenLinea').value='';document.getElementById('ordenFecha').value=new Date().toISOString().split('T')[0];document.getElementById('ordenProducto').innerHTML='<option value="">Selecciona l√≠nea</option>';document.getElementById('ordenCantidad').value='';document.getElementById('ordenLote').value='';document.getElementById('ordenVencimiento').value='';renderItemsOrden();openModal('modalNuevaOrden');}
function cargarProductosLinea(){const l=document.getElementById('ordenLinea').value,s=document.getElementById('ordenProducto');s.innerHTML='<option value="">Seleccionar</option>';if(l&&PRODUCTOS[l])PRODUCTOS[l].forEach(p=>s.innerHTML+='<option value="'+p.codigo+'">'+p.descripcion+'</option>');}
function agregarItemOrden(){const linea=document.getElementById('ordenLinea').value,pc=document.getElementById('ordenProducto').value,cant=document.getElementById('ordenCantidad').value,unidad=document.getElementById('ordenUnidad').value,lote=document.getElementById('ordenLote').value,venc=document.getElementById('ordenVencimiento').value;if(!linea||!pc||!cant||!lote){showToast('Completa campos','warning');return;}const prod=PRODUCTOS[linea].find(p=>p.codigo===pc);itemsOrdenTemp.push({codigo:pc,descripcion:prod.descripcion,cantidad:parseFloat(cant),unidad:unidad,lote:lote,vencimiento:venc});document.getElementById('ordenCantidad').value='';document.getElementById('ordenLote').value='';renderItemsOrden();showToast('√çtem agregado','success');}
function renderItemsOrden(){const cont=document.getElementById('itemsOrdenList');document.getElementById('itemsCount').textContent=itemsOrdenTemp.length;if(itemsOrdenTemp.length===0){cont.innerHTML='<div class="empty-state" style="padding:1rem;font-size:0.8rem">No hay √≠tems</div>';return;}cont.innerHTML=itemsOrdenTemp.map((it,i)=>'<div class="item-row"><span class="badge badge-success">'+it.codigo+'</span><div class="item-info"><div class="item-name">'+it.descripcion+'</div><div class="item-qty">'+it.cantidad+' '+it.unidad+' | '+it.lote+'</div></div><button class="btn btn-danger btn-remove" onclick="removeItemOrden('+i+')">√ó</button></div>').join('');}
function removeItemOrden(idx){itemsOrdenTemp.splice(idx,1);renderItemsOrden();}
function guardarOrden(){const linea=document.getElementById('ordenLinea').value,fecha=document.getElementById('ordenFecha').value,consecInterno=document.getElementById('ordenConsecInterno').value;if(!linea||itemsOrdenTemp.length===0){showToast('Agrega √≠tems','warning');return;}ordenes.push({id:Date.now().toString(),consecSistema:generarConsecSistema(),consecInterno:consecInterno||'-',linea:linea,fecha:fecha,items:JSON.parse(JSON.stringify(itemsOrdenTemp)),estado:'pendiente'});consecutivoSistema++;saveData();closeModal('modalNuevaOrden');itemsOrdenTemp=[];showToast('Orden creada','success');refreshDashboard();}
function refreshOrdenes(){const tb=document.getElementById('tableOrdenes');if(!tb)return;const t=new Date().toISOString().split('T')[0];const list=ordenes.filter(o=>o.fecha===t);if(list.length===0){tb.innerHTML='<tr><td colspan="5" class="empty-state">No hay √≥rdenes</td></tr>';return;}tb.innerHTML=list.map(o=>'<tr><td>'+o.consecSistema+'</td><td>'+o.consecInterno+'</td><td><span class="badge badge-'+o.linea.toLowerCase()+'">'+o.linea+'</span></td><td>'+o.items.length+'</td><td><span class="badge badge-'+(o.estado==='en_proceso'?'warning':'danger')+'">'+o.estado+'</span></td></tr>').join('');}
function filterOrdenes(f,btn){document.querySelectorAll('#mainContent .line-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');const tb=document.getElementById('tableOrdenes');const t=new Date().toISOString().split('T')[0];let list=ordenes.filter(o=>o.fecha===t);if(f!=='todas')list=list.filter(o=>o.linea===f);if(list.length===0){tb.innerHTML='<tr><td colspan="5" class="empty-state">No hay √≥rdenes</td></tr>';return;}tb.innerHTML=list.map(o=>'<tr><td>'+o.consecSistema+'</td><td>'+o.consecInterno+'</td><td><span class="badge badge-'+o.linea.toLowerCase()+'">'+o.linea+'</span></td><td>'+o.items.length+'</td><td><span class="badge badge-'+(o.estado==='en_proceso'?'warning':'danger')+'">'+o.estado+'</span></td></tr>').join('');}
function abrirModalEmpaque(){document.getElementById('empaqueOperario').value='';document.getElementById('empaqueLinea').value='';document.getElementById('empaqueProducto').innerHTML='<option value="">Selecciona l√≠nea</option>';document.getElementById('empaqueUnidades').value='';document.getElementById('empaqueKg').value='';document.getElementById('empaqueHoraInicio').value=new Date().toTimeString().slice(0,5);document.getElementById('empaqueHoraFin').value='';populateSelects();openModal('modalEmpaque');}
function cargarProductosEmpaque(){const l=document.getElementById('empaqueLinea').value,s=document.getElementById('empaqueProducto');s.innerHTML='<option value="">Seleccionar</option>';if(l&&PRODUCTOS[l])PRODUCTOS[l].forEach(p=>s.innerHTML+='<option value="'+p.codigo+'">'+p.descripcion+'</option>');}
function guardarEmpaque(){const opId=document.getElementById('empaqueOperario').value,linea=document.getElementById('empaqueLinea').value,producto=document.getElementById('empaqueProducto').value,unidades=parseInt(document.getElementById('empaqueUnidades').value)||0,kg=parseFloat(document.getElementById('empaqueKg').value)||0,horaInicio=document.getElementById('empaqueHoraInicio').value,horaFin=document.getElementById('empaqueHoraFin').value;if(!opId||!linea||!producto||(unidades===0&&kg===0)){showToast('Completa campos','warning');return;}const op=OPERARIOS.find(o=>o.id===opId);const prod=PRODUCTOS[linea].find(p=>p.codigo===producto);empaques.push({id:Date.now().toString(),fecha:new Date().toISOString().split('T')[0],operarioId:opId,operarioNombre:op.nombre,linea:linea,productoNombre:prod.descripcion,unidades:unidades,kg:kg,horaInicio:horaInicio,horaFin:horaFin});saveData();closeModal('modalEmpaque');showToast('Empaque registrado','success');refreshEmpaques();}
function refreshEmpaques(){const tb=document.getElementById('tableEmpaques');if(!tb)return;const t=new Date().toISOString().split('T')[0];const list=empaques.filter(e=>e.fecha===t);const uc=list.filter(e=>e.linea==='CRUDOS').reduce((s,e)=>s+e.unidades,0);const ua=list.filter(e=>e.linea==='APANADOS').reduce((s,e)=>s+e.unidades,0);const ud=list.filter(e=>e.linea==='DERIVADOS').reduce((s,e)=>s+e.unidades,0);const kgt=list.reduce((s,e)=>s+e.kg,0);const ec=document.getElementById('statEmpCrudos'),ea=document.getElementById('statEmpApanados'),ed=document.getElementById('statEmpDerivados'),ek=document.getElementById('statEmpKgTotal');if(ec)ec.textContent=uc;if(ea)ea.textContent=ua;if(ed)ed.textContent=ud;if(ek)ek.textContent=kgt.toFixed(1);if(list.length===0){tb.innerHTML='<tr><td colspan="6" class="empty-state">No hay empaques</td></tr>';return;}tb.innerHTML=list.map(e=>'<tr><td>'+e.operarioNombre.split(' ')[0]+'</td><td><span class="badge badge-'+e.linea.toLowerCase()+'">'+e.linea+'</span></td><td>'+e.productoNombre.substring(0,12)+'</td><td>'+e.unidades+'</td><td>'+e.kg+'</td><td>'+e.horaInicio+'</td></tr>').join('');}
function filterEmpaques(f,btn){document.querySelectorAll('#mainContent .line-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');const tb=document.getElementById('tableEmpaques');const t=new Date().toISOString().split('T')[0];let list=empaques.filter(e=>e.fecha===t);if(f!=='todas')list=list.filter(e=>e.linea===f);if(list.length===0){tb.innerHTML='<tr><td colspan="6" class="empty-state">No hay empaques</td></tr>';return;}tb.innerHTML=list.map(e=>'<tr><td>'+e.operarioNombre.split(' ')[0]+'</td><td><span class="badge badge-'+e.linea.toLowerCase()+'">'+e.linea+'</span></td><td>'+e.productoNombre.substring(0,12)+'</td><td>'+e.unidades+'</td><td>'+e.kg+'</td><td>'+e.horaInicio+'</td></tr>').join('');}
function selectLineaProduccion(l,btn){document.querySelectorAll('#mainContent .line-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');selectedLinea=l;document.getElementById('produccionEmpty').classList.add('hidden');document.getElementById('produccionForm').classList.remove('hidden');const infoCoccion=document.getElementById('infoCoccionProd');if(infoCoccion){if(l==='DERIVADOS')infoCoccion.classList.remove('hidden');else infoCoccion.classList.add('hidden');}const s=document.getElementById('prodOrden');const t=new Date().toISOString().split('T')[0];const ordenesLinea=ordenes.filter(o=>o.linea===l&&o.fecha===t&&o.estado!=='completada');s.innerHTML='<option value="">Seleccionar</option>';ordenesLinea.forEach(o=>s.innerHTML+='<option value="'+o.id+'">'+o.consecSistema+'</option>');const cc=document.getElementById('operariosChips');const ops=OPERARIOS.filter(o=>o.planta===l||o.planta==='TODA LA PRODUCCION');cc.innerHTML='';selectedOperarios=[];ops.forEach(op=>{const i=op.nombre.split(' ').map(n=>n[0]).slice(0,2).join('');cc.innerHTML+='<div class="operario-chip" onclick="toggleOperario(\''+op.id+'\',this)"><div class="operario-chip-avatar">'+i+'</div><span>'+op.nombre.split(' ')[0]+'</span></div>';});document.getElementById('prodHoraInicio').value=new Date().toTimeString().slice(0,5);}
function selectTurno(t,btn){document.querySelectorAll('.turno-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');selectedTurno=t;}
function toggleOperario(id,chip){chip.classList.toggle('selected');selectedOperarios=selectedOperarios.includes(id)?selectedOperarios.filter(o=>o!==id):selectedOperarios.concat([id]);}
function calcRendimiento(){const pi=parseFloat(document.getElementById('prodPesoInicial').value)||0,pf=parseFloat(document.getElementById('prodPesoFinal').value)||0;document.getElementById('prodRendimiento').value=pi>0&&pf>0?((pf/pi)*100).toFixed(1)+'%':'---%';}
function guardarProduccion(){const oid=document.getElementById('prodOrden').value,hi=document.getElementById('prodHoraInicio').value,hf=document.getElementById('prodHoraFin').value,pi=parseFloat(document.getElementById('prodPesoInicial').value)||0,pf=parseFloat(document.getElementById('prodPesoFinal').value)||0,u=parseInt(document.getElementById('prodUnidades').value)||0,k=parseFloat(document.getElementById('prodKg').value)||0;if(!oid||!hi||pi===0){showToast('Completa campos','warning');return;}const o=ordenes.find(x=>x.id===oid);const r=pi>0?((pf/pi)*100).toFixed(1):0;produccion.push({id:Date.now().toString(),fecha:new Date().toISOString().split('T')[0],ordenId:oid,ordenConsec:o?o.consecSistema:'',linea:selectedLinea,turno:selectedTurno,horaInicio:hi,horaFin:hf,pesoInicial:pi,pesoFinal:pf,rendimiento:r,unidades:u,kg:k,operarios:selectedOperarios});if(o)o.estado='en_proceso';saveData();showToast('Guardado','success');limpiarProduccion();refreshProduccionTable();}
function limpiarProduccion(){['prodOrden','prodHoraFin','prodPesoInicial','prodPesoFinal','prodUnidades','prodKg'].forEach(id=>{const e=document.getElementById(id);if(e)e.value='';});document.getElementById('prodRendimiento').value='---%';selectedOperarios=[];document.querySelectorAll('.operario-chip').forEach(c=>c.classList.remove('selected'));}
function refreshProduccionTable(){const tb=document.getElementById('tableProduccion');if(!tb)return;const t=new Date().toISOString().split('T')[0];const list=produccion.filter(p=>p.fecha===t);if(list.length===0){tb.innerHTML='<tr><td colspan="6" class="empty-state">No hay registros</td></tr>';return;}tb.innerHTML=list.map(p=>'<tr><td>'+p.horaInicio+'</td><td><span class="badge badge-'+p.linea.toLowerCase()+'">'+p.linea+'</span></td><td>'+p.ordenConsec+'</td><td>'+p.pesoInicial+'</td><td>'+p.pesoFinal+'</td><td>'+p.rendimiento+'%</td></tr>').join('');}
function selectLineaMerma(l,btn){document.querySelectorAll('#mainContent .line-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');selectedLinea=l;document.getElementById('mermaEmpty').classList.add('hidden');document.getElementById('mermaForm').classList.remove('hidden');const s=document.getElementById('mermaEstacion');s.innerHTML='<option value="">Seleccionar</option>';ESTACIONES[l].forEach(e=>s.innerHTML+='<option value="'+e+'">'+e+'</option>');}
function selectTipoMerma(t,btn){document.querySelectorAll('.merma-type-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');selectedTipoMerma=t;}
function guardarMerma(){const p=parseFloat(document.getElementById('mermaPeso').value)||0,e=document.getElementById('mermaEstacion').value,c=document.getElementById('mermaCausa').value;if(p===0||!e){showToast('Completa campos','warning');return;}mermas.push({id:Date.now().toString(),fecha:new Date().toISOString().split('T')[0],hora:new Date().toLocaleTimeString('es-CO',{hour:'2-digit',minute:'2-digit'}),linea:selectedLinea,tipo:selectedTipoMerma,peso:p,estacion:e,causa:c});saveData();showToast('Registrado','success');document.getElementById('mermaPeso').value='';document.getElementById('mermaCausa').value='';refreshMermasStats();}
function refreshMermasStats(){const t=new Date().toISOString().split('T')[0];const list=mermas.filter(m=>m.fecha===t);const tm=list.filter(m=>m.tipo==='merma').reduce((s,m)=>s+m.peso,0);const tr=list.filter(m=>m.tipo==='recorte').reduce((s,m)=>s+m.peso,0);const td=list.filter(m=>m.tipo==='desperdicio').reduce((s,m)=>s+m.peso,0);const tp=list.filter(m=>m.tipo==='reproceso').reduce((s,m)=>s+m.peso,0);const e1=document.getElementById('statMermaTotal'),e2=document.getElementById('statRecorte'),e3=document.getElementById('statDesperdicio'),e4=document.getElementById('statReproceso');if(e1)e1.textContent=(tm+tr+td).toFixed(1)+'kg';if(e2)e2.textContent=tr.toFixed(1)+'kg';if(e3)e3.textContent=td.toFixed(1)+'kg';if(e4)e4.textContent=tp.toFixed(1)+'kg';const tb=document.getElementById('tableMermas');if(!tb)return;if(list.length===0){tb.innerHTML='<tr><td colspan="5" class="empty-state">No hay mermas</td></tr>';return;}tb.innerHTML=list.map(m=>'<tr><td>'+m.hora+'</td><td><span class="badge badge-'+m.linea.toLowerCase()+'">'+m.linea+'</span></td><td><span class="badge badge-danger">'+m.tipo+'</span></td><td>'+m.peso+'kg</td><td>'+m.estacion+'</td></tr>').join('');}
function mostrarInfoCoccion(){const l=document.getElementById('prodLineaOp').value;const info=document.getElementById('infoCoccionDerivados');if(info){if(l==='DERIVADOS')info.classList.remove('hidden');else info.classList.add('hidden');}}
function cargarEstacionesLinea(){const l=document.getElementById('prodLineaOp').value,s=document.getElementById('prodEstacionOp');s.innerHTML='<option value="">Seleccionar</option>';if(l&&ESTACIONES[l])ESTACIONES[l].forEach(e=>s.innerHTML+='<option value="'+e+'">'+e+'</option>');}
function guardarProductividad(){const oid=document.getElementById('prodOperario').value,l=document.getElementById('prodLineaOp').value,e=document.getElementById('prodEstacionOp').value,u=parseInt(document.getElementById('prodUnidadesOp').value)||0,h=parseFloat(document.getElementById('prodHorasOp').value)||0;if(!oid||!l||!e||u===0||h===0){showToast('Completa campos','warning');return;}const op=OPERARIOS.find(o=>o.id===oid);const uh=(u/h).toFixed(1);productividad.push({id:Date.now().toString(),fecha:new Date().toISOString().split('T')[0],operarioId:oid,nombre:op.nombre,linea:l,estacion:e,unidades:u,horas:h,unidadesHora:uh});saveData();closeModal('modalProductividad');showToast('Registrado','success');refreshProductividadTable();}
function refreshProductividadTable(){const tb=document.getElementById('tableProductividad');if(!tb)return;const t=new Date().toISOString().split('T')[0];const list=productividad.filter(p=>p.fecha===t);if(list.length===0){tb.innerHTML='<tr><td colspan="7" class="empty-state">No hay registros</td></tr>';return;}tb.innerHTML=list.map(p=>{const lv=parseFloat(p.unidadesHora)>50?'success':parseFloat(p.unidadesHora)>30?'warning':'danger';const lt=lv==='success'?'ALTO':lv==='warning'?'MEDIO':'BAJO';return '<tr><td>'+p.nombre.split(' ')[0]+'</td><td><span class="badge badge-'+p.linea.toLowerCase()+'">'+p.linea+'</span></td><td>'+p.estacion+'</td><td>'+p.unidades+'</td><td>'+p.horas+'h</td><td>'+p.unidadesHora+'</td><td><span class="badge badge-'+lv+'">'+lt+'</span></td></tr>';}).join('');}
function filterProductividad(f,btn){document.querySelectorAll('#mainContent .line-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');const tb=document.getElementById('tableProductividad');const t=new Date().toISOString().split('T')[0];let list=productividad.filter(p=>p.fecha===t);if(f!=='todas')list=list.filter(p=>p.linea===f);if(list.length===0){tb.innerHTML='<tr><td colspan="7" class="empty-state">No hay registros</td></tr>';return;}tb.innerHTML=list.map(p=>{const lv=parseFloat(p.unidadesHora)>50?'success':parseFloat(p.unidadesHora)>30?'warning':'danger';const lt=lv==='success'?'ALTO':lv==='warning'?'MEDIO':'BAJO';return '<tr><td>'+p.nombre.split(' ')[0]+'</td><td><span class="badge badge-'+p.linea.toLowerCase()+'">'+p.linea+'</span></td><td>'+p.estacion+'</td><td>'+p.unidades+'</td><td>'+p.horas+'h</td><td>'+p.unidadesHora+'</td><td><span class="badge badge-'+lv+'">'+lt+'</span></td></tr>';}).join('');}
function refreshDashboard(){const t=new Date().toISOString().split('T')[0];const oh=ordenes.filter(o=>o.fecha===t);const ph=produccion.filter(p=>p.fecha===t);const so=document.getElementById('statOrdenes');if(so)so.textContent=oh.length;const kc=ph.filter(p=>p.linea==='CRUDOS').reduce((s,p)=>s+(p.kg||0),0);const ka=ph.filter(p=>p.linea==='APANADOS').reduce((s,p)=>s+(p.kg||0),0);const kd=ph.filter(p=>p.linea==='DERIVADOS').reduce((s,p)=>s+(p.kg||0),0);const sc=document.getElementById('statCrudos'),sa=document.getElementById('statApanados'),sd=document.getElementById('statDerivados');if(sc)sc.innerHTML=kc.toFixed(0)+'<span class="stat-unit">kg</span>';if(sa)sa.innerHTML=ka.toFixed(0)+'<span class="stat-unit">kg</span>';if(sd)sd.innerHTML=kd.toFixed(0)+'<span class="stat-unit">kg</span>';const rc=ph.filter(p=>p.linea==='CRUDOS'&&p.rendimiento>0);const ra=ph.filter(p=>p.linea==='APANADOS'&&p.rendimiento>0);const rd=ph.filter(p=>p.linea==='DERIVADOS'&&p.rendimiento>0);const ac=rc.length>0?rc.reduce((s,p)=>s+parseFloat(p.rendimiento),0)/rc.length:0;const aa=ra.length>0?ra.reduce((s,p)=>s+parseFloat(p.rendimiento),0)/ra.length:0;const ad=rd.length>0?rd.reduce((s,p)=>s+parseFloat(p.rendimiento),0)/rd.length:0;const pc=document.getElementById('progressCrudos'),pa=document.getElementById('progressApanados'),pd=document.getElementById('progressDerivados');if(pc)pc.style.width=Math.min(ac,100)+'%';if(pa)pa.style.width=Math.min(aa,100)+'%';if(pd)pd.style.width=Math.min(ad,100)+'%';const erc=document.getElementById('rendCrudos'),era=document.getElementById('rendApanados'),erd=document.getElementById('rendDerivados');if(erc)erc.textContent=ac.toFixed(1)+'%';if(era)era.textContent=aa.toFixed(1)+'%';if(erd)erd.textContent=ad.toFixed(1)+'%';const tb=document.getElementById('tableOrdenesActivas');if(!tb)return;const oa=oh.filter(o=>o.estado!=='completada');if(oa.length===0){tb.innerHTML='<tr><td colspan="5" class="empty-state">No hay √≥rdenes</td></tr>';return;}tb.innerHTML=oa.slice(0,5).map(o=>'<tr><td>'+o.consecSistema+'</td><td>'+o.consecInterno+'</td><td><span class="badge badge-'+o.linea.toLowerCase()+'">'+o.linea+'</span></td><td>'+o.items.length+'</td><td><span class="badge badge-'+(o.estado==='en_proceso'?'warning':'danger')+'">'+o.estado+'</span></td></tr>').join('');}
function exportarReporte(tipo){const d=(document.getElementById('reporteFechaDesde')||{}).value,h=(document.getElementById('reporteFechaHasta')||{}).value,l=(document.getElementById('reporteLinea')||{}).value;let data=[];if(tipo==='produccion')data=produccion;else if(tipo==='empaques')data=empaques;else if(tipo==='mermas')data=mermas;else if(tipo==='productividad')data=productividad;else if(tipo==='ordenes')data=ordenes.map(o=>({...o,items:o.items.length}));data=data.filter(x=>x.fecha>=d&&x.fecha<=h);if(l&&l!=='todas')data=data.filter(x=>x.linea===l);if(data.length===0){showToast('Sin datos','warning');return;}const headers=Object.keys(data[0]);const csv=[headers.join(',')].concat(data.map(r=>headers.map(hd=>{let v=r[hd];if(typeof v==='object')v=JSON.stringify(v);return '"'+(v||'')+'"';}).join(','))).join('\n');const blob=new Blob([csv],{type:'text/csv'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download='reporte_'+tipo+'.csv';link.click();showToast('Exportado','success');}
</script>
</body>
</html>
